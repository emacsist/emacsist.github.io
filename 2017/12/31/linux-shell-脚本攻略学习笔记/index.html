<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>&lt;Linux Shell 脚本攻略&gt;学习笔记 - emacsist</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="emacsist" />
  <meta name="description" content="shebang wiki 在计算机科学中，Shebang（也称为 Hashbang ）是一个由井号和" />

  <meta name="keywords" content="Golang, Java, PostgreSQL, Postgres, MySQL, emacsist, RabbitMQ, Go, emacs, orgmode" />






<meta name="generator" content="Hugo 0.58.3" />


<link rel="canonical" href="https://emacsist.github.io/2017/12/31/linux-shell-%E8%84%9A%E6%9C%AC%E6%94%BB%E7%95%A5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" />

<link href="." rel="alternate" type="application/rss+xml" title="emacsist" />
<link href="." rel="feed" type="application/rss+xml" title="emacsist" />



<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<link href="/dist/even.min.css?v=3.1.1" rel="stylesheet">





<meta property="og:title" content="&lt;Linux Shell 脚本攻略&gt;学习笔记" />
<meta property="og:description" content="shebang wiki 在计算机科学中，Shebang（也称为 Hashbang ）是一个由井号和" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://emacsist.github.io/2017/12/31/linux-shell-%E8%84%9A%E6%9C%AC%E6%94%BB%E7%95%A5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" />
<meta property="article:published_time" content="2017-12-31T21:59:39+00:00" />
<meta property="article:modified_time" content="2017-12-31T21:59:39+00:00" />
<meta itemprop="name" content="&lt;Linux Shell 脚本攻略&gt;学习笔记">
<meta itemprop="description" content="shebang wiki 在计算机科学中，Shebang（也称为 Hashbang ）是一个由井号和">


<meta itemprop="datePublished" content="2017-12-31T21:59:39&#43;00:00" />
<meta itemprop="dateModified" content="2017-12-31T21:59:39&#43;00:00" />
<meta itemprop="wordCount" content="4788">



<meta itemprop="keywords" content="bash,linux," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="&lt;Linux Shell 脚本攻略&gt;学习笔记"/>
<meta name="twitter:description" content="shebang wiki 在计算机科学中，Shebang（也称为 Hashbang ）是一个由井号和"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">emacsist</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">emacsist</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">&lt;Linux Shell 脚本攻略&gt;学习笔记</h1>

      <div class="post-meta">
        <span class="post-time"> 2017-12-31 </span>
        
        <span class="more-meta"> 4788 words </span>
        <span class="more-meta"> 10 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li><a href="#shebang">shebang</a></li>
<li><a href="#bash-的配置文件执行顺序">bash 的配置文件执行顺序</a></li>
<li><a href="#命令分隔">命令分隔</a></li>
<li><a href="#注释">注释</a></li>
<li><a href="#终端打印">终端打印</a>
<ul>
<li><a href="#echo">echo</a>
<ul>
<li><a href="#彩色转出">彩色转出</a>
<ul>
<li><a href="#文本">文本</a></li>
<li><a href="#背景">背景</a></li>
</ul></li>
</ul></li>
<li><a href="#printf">printf</a></li>
</ul></li>
<li><a href="#变量">变量</a>
<ul>
<li><a href="#环境变量">环境变量</a></li>
<li><a href="#终端环境变量">终端环境变量</a></li>
<li><a href="#进行的环境变量">进行的环境变量</a></li>
<li><a href="#变量赋值">变量赋值</a></li>
<li><a href="#引用变量的值">引用变量的值</a></li>
<li><a href="#获取变量的长度">获取变量的长度</a></li>
<li><a href="#获取当前的shell">获取当前的SHELL</a></li>
<li><a href="#检查是否-root-用户">检查是否 root 用户</a></li>
<li><a href="#修改提示符字符串">修改提示符字符串</a></li>
</ul></li>
<li><a href="#bash-中进行数学运算">Bash 中进行数学运算</a>
<ul>
<li><a href="#let">let</a></li>
<li><a href="#使用">使用 <code>[]</code></a></li>
<li><a href="#使用-1">使用 <code>(())</code></a></li>
<li><a href="#使用-expr">使用 expr</a></li>
<li><a href="#浮点运算-bc">浮点运算 bc</a>
<ul>
<li><a href="#设置精度">设置精度</a></li>
<li><a href="#进制转换">进制转换</a></li>
</ul></li>
</ul></li>
<li><a href="#文件描述符">文件描述符</a>
<ul>
<li><a href="#自定义文件描述符">自定义文件描述符</a>
<ul>
<li><a href="#读取">读取</a></li>
<li><a href="#写入">写入</a></li>
<li><a href="#追加">追加</a></li>
</ul></li>
</ul></li>
<li><a href="#重定向">重定向</a>
<ul>
<li><a href="#多行文件重定向">多行文件重定向</a></li>
</ul></li>
<li><a href="#命令的成功与否">命令的成功与否</a></li>
<li><a href="#数组">数组</a></li>
<li><a href="#关联数组">关联数组</a></li>
<li><a href="#别名">别名</a></li>
<li><a href="#日期和时间">日期和时间</a>
<ul>
<li><a href="#打印纪元时">打印纪元时</a></li>
<li><a href="#从指定时间转换为纪元">从指定时间转换为纪元</a></li>
<li><a href="#获取星期几">获取星期几</a></li>
<li><a href="#格式化日期">格式化日期</a></li>
<li><a href="#设置日期和时间">设置日期和时间</a></li>
</ul></li>
<li><a href="#调试脚本">调试脚本</a></li>
<li><a href="#函数">函数</a>
<ul>
<li><a href="#定义">定义</a></li>
<li><a href="#执行">执行</a></li>
<li><a href="#访问参数">访问参数</a></li>
<li><a href="#递归">递归</a></li>
<li><a href="#导出函数">导出函数</a></li>
<li><a href="#读取命令返回值-状态">读取命令返回值(状态)</a></li>
</ul></li>
<li><a href="#命令输出读入到变量">命令输出读入到变量</a></li>
<li><a href="#子shell">子shell</a>
<ul>
<li><a href="#保留空格和换行">保留空格和换行</a></li>
</ul></li>
<li><a href="#read-命令">read 命令</a>
<ul>
<li><a href="#读取-n-个字符到变量">读取 N 个字符到变量</a></li>
<li><a href="#用无回显的方式读取密码">用无回显的方式读取密码</a></li>
<li><a href="#显示提示信息">显示提示信息</a></li>
<li><a href="#在特定时限内读取">在特定时限内读取</a></li>
<li><a href="#用特定的定界符作为输入行的结束">用特定的定界符作为输入行的结束</a></li>
</ul></li>
<li><a href="#true-的命令">true 的命令</a></li>
<li><a href="#字段分隔符-ifs">字段分隔符 IFS</a></li>
<li><a href="#for-循环">for 循环</a>
<ul>
<li><a href="#序列">序列</a></li>
<li><a href="#for-的-c-风格">for 的 c 风格</a></li>
</ul></li>
<li><a href="#while-循环">while 循环</a></li>
<li><a href="#until-循环">until 循环</a></li>
<li><a href="#if">if</a></li>
<li><a href="#if-elif-else">if .. elif .. else</a></li>
<li><a href="#算术比较">算术比较</a></li>
<li><a href="#文件系统测试">文件系统测试</a></li>
<li><a href="#字符串比较">字符串比较</a></li>
<li><a href="#test-命令">test 命令</a></li>
<li><a href="#cat">cat</a></li>
<li><a href="#find-命令">find 命令</a>
<ul>
<li><a href="#or">OR</a></li>
<li><a href="#否定">否定</a></li>
<li><a href="#基于目录深度">基于目录深度</a></li>
<li><a href="#根据文件类型搜索">根据文件类型搜索</a></li>
<li><a href="#文件时间">文件时间</a></li>
<li><a href="#文件大小">文件大小</a></li>
<li><a href="#删除匹配">删除匹配</a></li>
<li><a href="#基于权限">基于权限</a></li>
<li><a href="#动作">动作</a></li>
</ul></li>
<li><a href="#tr-命令">tr 命令</a>
<ul>
<li><a href="#映射">映射</a></li>
<li><a href="#删除字符">删除字符</a></li>
<li><a href="#压缩字符">压缩字符</a></li>
</ul></li>
<li><a href="#校验和">校验和</a></li>
<li><a href="#加解密">加解密</a>
<ul>
<li><a href="#crypt">crypt</a></li>
<li><a href="#gpg">gpg</a></li>
<li><a href="#base64">base64</a></li>
</ul></li>
<li><a href="#临时文件">临时文件</a></li>
<li><a href="#提取文件名和扩展名">提取文件名和扩展名</a></li>
<li><a href="#并行操作">并行操作</a></li>
<li><a href="#dd-命令">dd 命令</a></li>
<li><a href="#不可删除的文件">不可删除的文件</a></li>
<li><a href="#diff-与文件补丁-patch">diff 与文件补丁 patch</a></li>
<li><a href="#快速定位目录">快速定位目录</a></li>
<li><a href="#wc-命令">wc 命令</a></li>
<li><a href="#正则">正则</a></li>
<li><a href="#cut-命令">cut 命令</a>
<ul>
<li><a href="#提取指定列">提取指定列</a></li>
<li><a href="#排除指定列">排除指定列</a></li>
<li><a href="#指定界定符">指定界定符</a></li>
<li><a href="#指定字段的字符或字节范围">指定字段的字符或字节范围</a></li>
</ul></li>
<li><a href="#sed-命令">sed 命令</a>
<ul>
<li><a href="#替换字符串">替换字符串</a></li>
<li><a href="#应用到文件">应用到文件</a></li>
<li><a href="#全局应用">全局应用</a></li>
<li><a href="#界定符">界定符</a></li>
<li><a href="#移除空白行">移除空白行</a></li>
</ul></li>
<li><a href="#awk">awk</a>
<ul>
<li><a href="#特殊变量">特殊变量</a></li>
<li><a href="#将外部变量传递给-awk">将外部变量传递给 awk</a></li>
<li><a href="#设置字段界定符">设置字段界定符</a></li>
<li><a href="#内建函数">内建函数</a></li>
</ul></li>
<li><a href="#paste-命令-列拼接">paste 命令:列拼接</a></li>
<li><a href="#tac">tac</a></li>
<li><a href="#wget">wget</a>
<ul>
<li><a href="#指定多个下载">指定多个下载</a></li>
<li><a href="#指定输出文件">指定输出文件</a></li>
<li><a href="#重试次数">重试次数</a></li>
<li><a href="#限速">限速</a></li>
<li><a href="#最大下载配额">最大下载配额</a></li>
<li><a href="#断点续传">断点续传</a></li>
<li><a href="#复制整个网站">复制整个网站</a></li>
</ul></li>
<li><a href="#curl-命令">curl 命令</a>
<ul>
<li><a href="#避免显示进度">避免显示进度</a></li>
<li><a href="#下载">下载</a></li>
<li><a href="#型进度条"><code>#</code> 型进度条</a></li>
<li><a href="#断点续传-1">断点续传</a></li>
<li><a href="#设置-referer">设置 referer</a></li>
<li><a href="#设置-cookie">设置 cookie</a></li>
<li><a href="#将-cookie-另存为文件">将 cookie 另存为文件</a></li>
<li><a href="#请求时-带上cookie文件中的cookie">请求时, 带上cookie文件中的cookie</a></li>
<li><a href="#限制带宽">限制带宽</a></li>
<li><a href="#只打印头部">只打印头部</a></li>
</ul></li>
<li><a href="#tar-命令">tar 命令</a></li>
<li><a href="#rsync-命令">rsync 命令</a>
<ul>
<li><a href="#排除">排除</a></li>
<li><a href="#同步时在dest-path中删除源端不存在的文件">同步时在dest_path中删除源端不存在的文件</a></li>
</ul></li>
<li><a href="#fsarchiver-命令">fsarchiver 命令</a>
<ul>
<li><a href="#创建">创建</a></li>
<li><a href="#恢复">恢复</a></li>
<li><a href="#脚本中使用-eof-的-raw-string">脚本中使用 EOF 的 raw string</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<h1 id="shebang">shebang</h1>

<p><a href="https://zh.wikipedia.org/wiki/Shebang">wiki</a></p>

<blockquote>
<p>在计算机科学中，Shebang（也称为 Hashbang ）是一个由井号和叹号构成的字符序列 #! ，其出现在文本文件的第一行的前两个字符</p>
</blockquote>

<h1 id="bash-的配置文件执行顺序">bash 的配置文件执行顺序</h1>

<p>这里自己额外想到的, 所以整理了下网上的资料</p>

<p><a href="https://shreevatsa.wordpress.com/2008/03/30/zshbash-startup-files-loading-order-bashrc-zshrc-etc/">Zsh/Bash startup files loading order (.bashrc, .zshrc etc.)</a></p>

<pre><code class="language-bash">+----------------|-----------|-----------|------+
|                |Interactive|Interactive|Script|
|                |login      |non-login  |      |
+----------------|-----------|-----------|------+
|/etc/profile    |   A       |           |      |
+----------------|-----------|-----------|------+
|/etc/bash.bashrc|           |    A      |      |
+----------------|-----------|-----------|------+
|~/.bashrc       |           |    B      |      |
+----------------|-----------|-----------|------+
|~/.bash_profile |   B1      |           |      |
+----------------|-----------|-----------|------+
|~/.bash_login   |   B2      |           |      |
+----------------|-----------|-----------|------+
|~/.profile      |   B3      |           |      |
+----------------|-----------|-----------|------+
|BASH_ENV        |           |           |  A   |
+----------------|-----------|-----------|------+
|                |           |           |      |
+----------------|-----------|-----------|------+
|                |           |           |      |
+----------------|-----------|-----------|------+
|~/.bash_logout  |    C      |           |      |
+----------------|-----------|-----------|------+
</code></pre>

<p>对于 zsh</p>

<pre><code class="language-bash">+----------------|-----------|-----------|------+
|                |Interactive|Interactive|Script|
|                |login      |non-login  |      |
+----------------|-----------|-----------|------+
|/etc/zshenv     |    A      |    A      |  A   |
+----------------|-----------|-----------|------+
|~/.zshenv       |    B      |    B      |  B   |
+----------------|-----------|-----------|------+
|/etc/zprofile   |    C      |           |      |
+----------------|-----------|-----------|------+
|~/.zprofile     |    D      |           |      |
+----------------|-----------|-----------|------+
|/etc/zshrc      |    E      |    C      |      |
+----------------|-----------|-----------|------+
|~/.zshrc        |    F      |    D      |      |
+----------------|-----------|-----------|------+
|/etc/zlogin     |    G      |           |      |
+----------------|-----------|-----------|------+
|~/.zlogin       |    H      |           |      |
+----------------|-----------|-----------|------+
|                |           |           |      |
+----------------|-----------|-----------|------+
|                |           |           |      |
+----------------|-----------|-----------|------+
|~/.zlogout      |    I      |           |      |
+----------------|-----------|-----------|------+
|/etc/zlogout    |    J      |           |      |
+----------------|-----------|-----------|------+
</code></pre>

<h1 id="命令分隔">命令分隔</h1>

<p>用分号或换行符. 即:</p>

<pre><code class="language-bash">cmd1; cmd2
</code></pre>

<p>等同于</p>

<pre><code class="language-bash">cmd1
cmd2
</code></pre>

<h1 id="注释">注释</h1>

<blockquote>
<p>#</p>
</blockquote>

<p>以 <code>#</code> 符号及之后的行内容都是注释</p>

<h1 id="终端打印">终端打印</h1>

<h2 id="echo">echo</h2>

<ul>
<li>双引号的字符串则会进行变量替换</li>
<li>单引号的字符串则不会进行变量替换</li>
<li>默认情况下, 会自动添加换行</li>
</ul>

<p><code>-n</code> 参数: 忽略结尾的换行
<code>-e</code> 参数: 表示包含转义序列</p>

<h3 id="彩色转出">彩色转出</h3>

<h4 id="文本">文本</h4>

<p>颜色码:</p>

<ul>
<li>0 重置</li>
<li>30 黑色</li>
<li>31 红色</li>
<li>37 白色
等等</li>
</ul>

<p>例如</p>

<pre><code class="language-bash">echo &quot;\e[1;31m Hello World\e[0m&quot;
</code></pre>

<h4 id="背景">背景</h4>

<p>颜色码:</p>

<ul>
<li>0 重置</li>
<li>40 黑色</li>
<li>41 红色</li>

<li><p>47 白色
等等</p>

<pre><code class="language-bash">echo &quot;\e[1;42m Hello World\e[0m&quot;
</code></pre></li>
</ul>

<h2 id="printf">printf</h2>

<p>与 C 语言中的 <code>printf</code> 函数参数一样.</p>

<ul>
<li>默认情况下, 不会自动添加换行</li>
</ul>

<h1 id="变量">变量</h1>

<p>在 Bash 中, 每一个变量的值都是字符串, 无论你给变量赋值时有没有使用引号, 值都会以字符串的形式存储.</p>

<h2 id="环境变量">环境变量</h2>

<p>有一些特殊的变量会被Shell环境和操作系统用来存储一些特别的值, 这类变量就称为 <code>环境变量</code></p>

<h2 id="终端环境变量">终端环境变量</h2>

<p>使用 <code>env</code> 命令查看.</p>

<h2 id="进行的环境变量">进行的环境变量</h2>

<pre><code class="language-bash">cat /proc/$PID/environ
</code></pre>

<p>上面返回的是变量的列表, 以 <code>name=value</code> 的形式来描述. 之间由 <code>\0</code> 分隔. 可将 <code>\0</code> 替换为 <code>\n</code> 就可使每一行显示了.</p>

<pre><code class="language-bash">cat /proc/$PID/environ | tr '\0' '\n'
</code></pre>

<h2 id="变量赋值">变量赋值</h2>

<pre><code class="language-bash">var=value
</code></pre>

<p>注意, 它不同于</p>

<pre><code class="language-bash">var = value
</code></pre>

<p>前者才是赋值, 后者是相等操作.</p>

<h2 id="引用变量的值">引用变量的值</h2>

<p><code>$var</code></p>

<p>或</p>

<p><code>${var}</code></p>

<p>注意, 如果包含在单引号里, 变量不会被扩展. 将依照原样显示.</p>

<h2 id="获取变量的长度">获取变量的长度</h2>

<pre><code class="language-bash">length=${#var}
</code></pre>

<h2 id="获取当前的shell">获取当前的SHELL</h2>

<pre><code class="language-bash">echo $0

或

echo $SHELL
</code></pre>

<h2 id="检查是否-root-用户">检查是否 root 用户</h2>

<pre><code class="language-bash">if [ $UID -ne 0 ]; then
	echo &quot;Non root user&quot;
else
	echo &quot;root user&quot;
if
</code></pre>

<h2 id="修改提示符字符串">修改提示符字符串</h2>

<p>在文件 <code>~/.bashrc</code> 中的某一行的 <code>PS1</code> 变量中设置的.</p>

<h1 id="bash-中进行数学运算">Bash 中进行数学运算</h1>

<h2 id="let">let</h2>

<p>使用let时, 变量名之前不需要添加 <code>$</code> , 例如:</p>

<pre><code class="language-bash">no1=4
no2=5

let result=no1+no2

echo $result
</code></pre>

<p>自加和自减,缩写</p>

<pre><code class="language-bash">let no1++
let no1--

let no1+=6
let no1-=6
</code></pre>

<h2 id="使用">使用 <code>[]</code></h2>

<pre><code class="language-bash">result=$[ no1 + no2 ]

或

result=$[ $no1 + 5 ]
</code></pre>

<h2 id="使用-1">使用 <code>(())</code></h2>

<p>这种变量名之前要加上 <code>$</code></p>

<pre><code class="language-bash">result=$(( no1 + 50 ))
</code></pre>

<h2 id="使用-expr">使用 expr</h2>

<pre><code class="language-bash">result=`expr 3 + 4`

result=$(expr $no1 + 5)
</code></pre>

<h2 id="浮点运算-bc">浮点运算 bc</h2>

<pre><code class="language-bash">echo &quot;4 * 0.45&quot; | bc
</code></pre>

<h3 id="设置精度">设置精度</h3>

<pre><code class="language-bash">echo &quot;scale=2; 3/8&quot; | bc
</code></pre>

<h3 id="进制转换">进制转换</h3>

<pre><code class="language-bash">echo &quot;obase=2; 1000&quot; | bc
</code></pre>

<p><code>obase</code> : 输出进制
<code>ibase</code> : 输入进制</p>

<h1 id="文件描述符">文件描述符</h1>

<blockquote>
<p>文件描述符是一种用于访问文件的抽象指示器. 存取文件离不开被称为 <code>文件描述符</code> 的特殊数字.</p>
</blockquote>

<pre><code class="language-bash">0 : 标准输入 stdin /dev/stdin
1 : 标准输出 stdout /dev/stdout
2 : 标准错误 stderr /dev/stderr
</code></pre>

<h2 id="自定义文件描述符">自定义文件描述符</h2>

<p>文件打开模式通常有3种</p>

<ol>
<li>只读</li>
<li>截断写入</li>

<li><p>追加写入</p>

<pre><code class="language-bash">&lt; : 从文件中读取内容到 stdin
&gt; : 用于截断模式写入
&gt;&gt; : 用于追加模式写入
</code></pre></li>
</ol>

<h3 id="读取">读取</h3>

<p>创建一个文件描述符进行读取:</p>

<pre><code class="language-bash">exec 3&lt;input.txt
</code></pre>

<p>这表示使用文件描述符3打开并读取文件.</p>

<p>使用文件描述符</p>

<pre><code class="language-bash">cat &lt;&amp;3
</code></pre>

<p>注意, 只能读取一次, 若要再次读取, 则要重新使用 exec 来分配文件描述符进行二次读取.</p>

<h3 id="写入">写入</h3>

<pre><code class="language-bash"># 创建
exec 4&gt;output.txt

# 使用
echo &quot;ehllo&quot; &gt;&amp;4
</code></pre>

<h3 id="追加">追加</h3>

<pre><code class="language-bash">exec 5&gt;&gt;output.txt

echo &quot;hello&quot; &gt;&amp;5
</code></pre>

<p>注意, 是使用 <code>&gt;&amp;5</code></p>

<h1 id="重定向">重定向</h1>

<pre><code class="language-bash">&gt; : 旧内容会被清空, 然后设置为新的内容. 这等同于 1&gt;

&gt;&gt; : 追加到旧内容尾部. 这等同于 1&gt;&gt;


&lt; : 用于从文件中读取内容到 stdin
</code></pre>

<p>将 <code>stderr</code> 和 <code>stdout</code> 分别重定向到一个文件:</p>

<pre><code class="language-bash">cmd 2&gt;stderr.txt 1&gt;stdout.txt
</code></pre>

<p><code>stderr</code> 和 <code>stdout</code> 一起重定向:</p>

<pre><code class="language-bash">cmd 2&gt;&amp;1 output.txt
</code></pre>

<p>忽略错误输出:</p>

<pre><code class="language-bash">cmd 2&gt;/dev/null 1&gt;output.txt
</code></pre>

<p>同时重定向到文件和 <code>stdout</code></p>

<pre><code class="language-bash">command | tee FILE2 FILE2
</code></pre>

<p>注意, <code>tee</code> 只能读取 <code>stdout</code> 而不包括 <code>stderr</code></p>

<p>使用 <code>stdin</code> 作为命令行参数:</p>

<pre><code class="language-bash">cmd 1 | cmd2 | cmd3 -
</code></pre>

<p>即 <code>-</code> 作为命令的文件名参数即可.</p>

<h2 id="多行文件重定向">多行文件重定向</h2>

<pre><code class="language-bash">cat &lt;&lt; EOF &gt; log.txt
这里是内容
EOF
</code></pre>

<p>理解: <a href="https://stackoverflow.com/questions/2500436/how-does-cat-eof-work-in-bash">stackoverflow.com</a></p>

<blockquote>
<p>这表示, 指示 shell 直接从当前源中读取输入, 直到有一行的内容仅包含 EOF 这个单词.</p>
</blockquote>

<h1 id="命令的成功与否">命令的成功与否</h1>

<pre><code class="language-bash">echo $?
</code></pre>

<p>如果返回0, 表示上一个命令执行成功, 否则是失败.</p>

<h1 id="数组">数组</h1>

<p>起始索引为0.</p>

<p>定义</p>

<pre><code class="language-bash">array_var=(1 2 3 4 5 6)
</code></pre>

<p>使用</p>

<pre><code class="language-bash">echo ${array_var[0]}
</code></pre>

<p>打印数组所有值</p>

<pre><code class="language-bash">echo ${array_var[*]}

或

echo ${array_var[@]}
</code></pre>

<p>长度</p>

<pre><code class="language-bash">echo ${#array_var[*]}
</code></pre>

<h1 id="关联数组">关联数组</h1>

<p>定义</p>

<pre><code class="language-bash">declare -A ass_array

ass_array=([key1]=value [key2]=value2)

或
ass_array[key1]=value1
ass_array[key2]=value2
</code></pre>

<p>使用</p>

<pre><code class="language-bash">echo ${ass_array[key]}
</code></pre>

<p>列出数组索引</p>

<pre><code class="language-bash">echo ${! ass_array[*]}

或

echo ${! ass_array[@]}
</code></pre>

<h1 id="别名">别名</h1>

<pre><code class="language-bash">alias new_command='command sequence'
</code></pre>

<p>永久保存: 将内容写到 <code>~/.bashrc</code></p>

<p>删除别名</p>

<pre><code class="language-bash">alias new_command=
unalias new_command
</code></pre>

<h1 id="日期和时间">日期和时间</h1>

<p>纪元时或 Unix 时间: UTC 1970年1月1日 0时0分0秒起所流逝的秒数.</p>

<pre><code class="language-bash">date
</code></pre>

<h2 id="打印纪元时">打印纪元时</h2>

<pre><code class="language-bash">date +%s
</code></pre>

<h2 id="从指定时间转换为纪元">从指定时间转换为纪元</h2>

<pre><code class="language-bash">date --date &quot;Thu Nov 18 08:07:21 IST 2010&quot; +%s
</code></pre>

<p><code>--date</code> 用于提供日期字符串作为输入.</p>

<h2 id="获取星期几">获取星期几</h2>

<pre><code class="language-bash">date --date &quot;Jan 20 2001&quot; +%A
</code></pre>

<h2 id="格式化日期">格式化日期</h2>

<p><a href="https://ss64.com/bash/date.html">格式化占位符列表</a></p>

<pre><code class="language-bash">date &quot;+%d %B %Y&quot;
</code></pre>

<h2 id="设置日期和时间">设置日期和时间</h2>

<pre><code class="language-bash">date -s &quot;格式化的日期字符串&quot;
</code></pre>

<h1 id="调试脚本">调试脚本</h1>

<pre><code class="language-bash">bash -x script.sh
</code></pre>

<p>在脚本内部, 进行部分调试</p>

<pre><code class="language-bash">set -x
要调试的代码段
set +x
</code></pre>

<p><code>-x</code> : 执行时显示命令和参数
<code>+x</code> : 禁止调试
<code>-v</code> : 当命令进行读取时显示输入
<code>+v</code> : 禁止打印输入</p>

<h1 id="函数">函数</h1>

<h2 id="定义">定义</h2>

<pre><code class="language-bash">function fname() {
	statements;
}

或

fname() {
	statements;
}
</code></pre>

<h2 id="执行">执行</h2>

<pre><code class="language-bash">fname;

传递参数

fname arg1 arg2;
</code></pre>

<h2 id="访问参数">访问参数</h2>

<pre><code class="language-bash">function fname(){
	echo $1,  $2 # 访问参数1, 参数2
    echo &quot;$@&quot; # 以列表的方式一次性打印所有参数
    echo &quot;$*&quot;; # 类似 $@, 但是参数被作为单个实体
    return 0; # 返回值
}
</code></pre>

<p>即</p>

<ul>
<li><code>$1</code> 是第一个参数</li>
<li><code>$2</code> 是第二个参数</li>
<li><code>$n</code> 是第n个参数</li>
<li><code>$@</code> 被扩展为&rdquo;$1&rdquo; &ldquo;$2&rdquo; &ldquo;$3&rdquo; 等</li>
<li><code>$*</code> 被扩展成 &ldquo;$1c$2c$3&rdquo;, 其中c是IFS的第一个字符</li>
<li><code>$@</code> 用的比 <code>$*</code> 多, 因为 <code>$*</code> 将所有参数当作单个字符串, 因此它很少被使用</li>
</ul>

<h2 id="递归">递归</h2>

<p>bash 支持递归调用</p>

<h2 id="导出函数">导出函数</h2>

<p>函数也可以像环境变量一样用 <code>export</code> 导出, 如此一来, 函数的作用域就可以扩展到子进程中. 例如</p>

<pre><code class="language-bash">export -f fname
</code></pre>

<h2 id="读取命令返回值-状态">读取命令返回值(状态)</h2>

<pre><code class="language-bash">cmd;
echo $?
</code></pre>

<p><code>$?</code> 会给出命令 cmd 的返回值. 这个返回值被称为退出状态.</p>

<h1 id="命令输出读入到变量">命令输出读入到变量</h1>

<pre><code class="language-bash"># 这种方法称为子shell
cmd_output=$(COMMANDS)

或
# 这种方法称为 反引用
cmd_output=`COMMANDS`
</code></pre>

<h1 id="子shell">子shell</h1>

<pre><code class="language-bash">pwd;
(cd /bin ; ls);
pwd;
</code></pre>

<p>第二行中的语句即为子shell, 它不会对当前shell有任何影响.所有改变仅限于子shell内.</p>

<h2 id="保留空格和换行">保留空格和换行</h2>

<p>利用子shell或反引用的方法将命令的输出读入到一个变量中, 可以将它放在双引号中, 即可保留空格和换行符.</p>

<p>如</p>

<pre><code class="language-bash">out=$(cat file.txt)

out1=&quot;$(cat file.txt)&quot;
</code></pre>

<blockquote>
<p>注, 像好这个没有效果. 我在 Ubuntu 16.04.2 LTS , GNU bash, version 4.3.46(1)-release (x86_64-pc-linux-gnu) 版本中测试没有效果. 有待处理.</p>
</blockquote>

<h1 id="read-命令">read 命令</h1>

<h2 id="读取-n-个字符到变量">读取 N 个字符到变量</h2>

<pre><code class="language-bash">read -n N var_name
</code></pre>

<h2 id="用无回显的方式读取密码">用无回显的方式读取密码</h2>

<pre><code class="language-bash">read -s var
</code></pre>

<h2 id="显示提示信息">显示提示信息</h2>

<pre><code class="language-bash">read -p &quot;enter input:&quot; var
</code></pre>

<h2 id="在特定时限内读取">在特定时限内读取</h2>

<pre><code class="language-bash">read -t timeout var
</code></pre>

<p>单位秒</p>

<h2 id="用特定的定界符作为输入行的结束">用特定的定界符作为输入行的结束</h2>

<pre><code class="language-bash">read -d delim_char var
</code></pre>

<h1 id="true-的命令">true 的命令</h1>

<pre><code class="language-bash">:
</code></pre>

<p>它是内建命令, 总是会返回为0的退出码.</p>

<h1 id="字段分隔符-ifs">字段分隔符 IFS</h1>

<p>IFS 是存储定界符的环境变量, 它是当前 shell 环境使用的默认定界字符串.</p>

<p>它的值, 默认为 <code>空白字符</code></p>

<pre><code class="language-bash">#!/bin/bash

data=&quot;1,2,3,4,5&quot;

oldIFS=$IFS

IFS=,

for item in $data;
do
  echo Item: $item
done

IFS=$oldIFS
</code></pre>

<p>输出</p>

<pre><code class="language-bash">./hello.sh
Item: 1
Item: 2
Item: 3
Item: 4
Item: 5
</code></pre>

<h1 id="for-循环">for 循环</h1>

<pre><code class="language-bash">for var in list;
do

	commands;
done    
</code></pre>

<p><code>list</code> 可以是字符串, 也可以是一个序列.</p>

<h2 id="序列">序列</h2>

<pre><code class="language-bash">{1..50}
</code></pre>

<p>表示从1到50的数字列表.</p>

<pre><code class="language-bash">{a..z}
</code></pre>

<h2 id="for-的-c-风格">for 的 c 风格</h2>

<pre><code class="language-bash">for ((i=0;i&lt;10;i+)) {
	commands;
}
</code></pre>

<h1 id="while-循环">while 循环</h1>

<pre><code class="language-bash">while condition
do

	commands;
done    
</code></pre>

<h1 id="until-循环">until 循环</h1>

<pre><code class="language-bash">until condition;
do
	commands;
done    
</code></pre>

<h1 id="if">if</h1>

<pre><code class="language-bash">
if condition;
then
	commands;
fi    

</code></pre>

<h1 id="if-elif-else">if .. elif .. else</h1>

<pre><code class="language-bash">if condition;
then
	commands;
elif condition; then
	commands;
else
	commands;
fi
</code></pre>

<h1 id="算术比较">算术比较</h1>

<pre><code class="language-bash">[ $var -eq 0 ]
</code></pre>

<p>注意, 中括号与操作数之间要有空白.</p>

<ul>
<li>-gt : 大于</li>
<li>-lt : 小于</li>
<li>-ge : 大于等于</li>
<li>-le : 小于等于</li>
</ul>

<p>组合</p>

<pre><code class="language-bash">[ $var -ne 0 -a $var2 -gt 2 ] # 表示逻辑与, -a

[ $var -ne 0 -o $var2 -gt 2 ] # 表示逻辑或, -o
</code></pre>

<h1 id="文件系统测试">文件系统测试</h1>

<pre><code class="language-bash">[ -f $file_var ] # 如果是正常的文件路或文件名

[ -x $var ] # 如果给定的变量包含的文件可执行, 则返回真

[ -d $var ] # 如果是目录

[ -e $var ] # 如果文件存在

[ -c $var ] # 如果是字符设备

[ -b $var ] # 如果是块设备

[ -w $var ] # 如果文件可写

[ -r $var ] # 如果文件可读

[ -L $var ] # 如果是符号链接
</code></pre>

<h1 id="字符串比较">字符串比较</h1>

<blockquote>
<p>最好使用双中括号</p>
</blockquote>

<pre><code class="language-bash">[[ $str1 = $str2 ]] # 如果相等

[[ $str1 == $str2 ]] # 如果相等

[[ $str1 != $str2 ]] # 如果不相等

[[ $str &gt; $str2 ]] # 大于

[[ $str &lt; $str2 ]] # 小于

[[ -z $str1 ]] # 如果是空字符串

[[ -n $str1 ]] # 如果是非空字符串
</code></pre>

<p>组合</p>

<pre><code class="language-bash">[[ -n $str1 ]] &amp;&amp; [[ -z $str2 ]]
</code></pre>

<h1 id="test-命令">test 命令</h1>

<pre><code class="language-bash">if [ $var -eq 0 ]; then
	echo &quot;True&quot;;
fi    
</code></pre>

<p>与可以写为</p>

<pre><code class="language-bash">if test $var -eq 0; then
	echo &quot;True&quot;;
fi
</code></pre>

<h1 id="cat">cat</h1>

<ul>
<li>-s : 压缩多行空行为一行空行</li>
<li>-T : 显示制表符</li>
<li>-n : 显示行号</li>
<li>-b : 显示行号, 但不为空白行设置行号</li>
</ul>

<h1 id="find-命令">find 命令</h1>

<pre><code class="language-bash">find base_path -print0
</code></pre>

<ul>
<li>-print0 表示以 &lsquo;\0&rsquo; 作为文件名的界定符. 默认为换行符, 但当文件名包含换行符时, 这就有用了. 注意, 是连起来的 <code>-print0</code></li>
<li>-name &ldquo;*.txt&rdquo; 正则匹配.</li>
<li>-iname &ldquo;*.txt&rdquo; 忽略大小写</li>
</ul>

<h2 id="or">OR</h2>

<pre><code class="language-bash">find . \( -name &quot;*.txt&quot; -o -name &quot;*.pdf&quot; \) -print
</code></pre>

<h2 id="否定">否定</h2>

<pre><code class="language-bash">find . ! -name &quot;*.txt&quot; -print
</code></pre>

<p>表示匹配所有不以 <code>*.txt</code> 结尾的文件名.</p>

<h2 id="基于目录深度">基于目录深度</h2>

<p>默认情况下, find 会遍历所有子目录.可以添加选项来限定深度.</p>

<ul>
<li>-maxdepth</li>
<li>-mindepth</li>
</ul>

<p>这两个参数应该是 find 的第三个参数, 否则可能会影响效率.</p>

<h2 id="根据文件类型搜索">根据文件类型搜索</h2>

<ul>
<li>-type d 目录类型</li>
<li>-type f 文件类型</li>
<li>-type l 符号链接类型</li>
<li>-type c 字符设备</li>
<li>-type b 块设备</li>
<li>-type s 套接字</li>
</ul>

<h2 id="文件时间">文件时间</h2>

<ul>
<li>-atime : 用户最近一次访问时间</li>
<li>-mtime : 文件内容最后一次修改时间</li>
<li>-ctime : 文件元数据最后一次改变的时间</li>
</ul>

<p>后接 <code>+N 或 -N</code> 单位是天. 负号表示是小于, 正号表示大于</p>

<ul>
<li>-amin : 访问时间</li>
<li>-mmin : 修改时间</li>
<li>-cmin : 变化时间</li>
</ul>

<p>这些同上, 只是时间单位为分.</p>

<h2 id="文件大小">文件大小</h2>

<ul>
<li>-size +2K : 表示大于 2KB 的文件</li>
<li>-size -2K : 表示小于 2KB 的文件</li>
</ul>

<p>单位</p>

<ul>
<li>b : 512 字节</li>
<li>c : 字节</li>
<li>w : 2字</li>
<li>k : 1024 字节</li>
<li>M : 1024 K 字节</li>
<li>G : 1024 M 字节</li>
</ul>

<h2 id="删除匹配">删除匹配</h2>

<ul>
<li>-delete</li>
</ul>

<h2 id="基于权限">基于权限</h2>

<ul>
<li>-perm 664</li>
</ul>

<h2 id="动作">动作</h2>

<ul>
<li><p>-exec</p>

<pre><code class="language-bash">find . -type f -exec cat {} \;&gt; outout.txt
</code></pre></li>
</ul>

<p>多命令</p>

<p>exec 不支持执行多命令, 但可以变换一个, 将命令写入脚本, 然后调用</p>

<pre><code class="language-bash">-exec ./commands.sh {} \;
</code></pre>

<h1 id="tr-命令">tr 命令</h1>

<p>转换源.</p>

<h2 id="映射">映射</h2>

<pre><code class="language-bash">tr [options] set1 set2
</code></pre>

<h2 id="删除字符">删除字符</h2>

<pre><code class="language-bash">tr -d '[set1]'
</code></pre>

<h2 id="压缩字符">压缩字符</h2>

<pre><code class="language-bash">tr -s ' '
</code></pre>

<p>将多个空白压缩为一个.</p>

<h1 id="校验和">校验和</h1>

<pre><code class="language-bash">md5sum filename

sh1sum filename
</code></pre>

<h1 id="加解密">加解密</h1>

<h2 id="crypt">crypt</h2>

<p>它是一个简单的加密工具, 从 stdin 接受一个文件以及口令作为输入, 然后将加密数据输出到 stdout</p>

<pre><code class="language-bash">crypt &lt; input_file &gt; output_file
</code></pre>

<p>解密</p>

<pre><code class="language-bash">crypt -d &lt; encrypted_file &gt; output_file
</code></pre>

<h2 id="gpg">gpg</h2>

<p>加密</p>

<pre><code class="language-bash">gpg -c filename
</code></pre>

<p>解密</p>

<pre><code class="language-bash">gpg filename.gpg
</code></pre>

<h2 id="base64">base64</h2>

<pre><code class="language-bash">base64 filename &gt; outputfile
</code></pre>

<p>解码</p>

<pre><code class="language-bash">base64 -d file &gt; outputfile
</code></pre>

<h1 id="临时文件">临时文件</h1>

<pre><code class="language-bash">filename=`mktemp`

dirname=`mktemp -d`
</code></pre>

<p>仅生成文件名, 而不是实际的文件</p>

<pre><code class="language-bash">tempfile=`mktemp -u`
</code></pre>

<p>根据模板创建</p>

<pre><code class="language-bash">mktemp test.XXX
</code></pre>

<p>它会生成 <code>test.XXX</code> 形式的临时文件.</p>

<h1 id="提取文件名和扩展名">提取文件名和扩展名</h1>

<pre><code class="language-bash">file_jpg=&quot;sample.jpg&quot;

fileName=${file_jpg%.*}
suffixName=${file_jpg#*.}
</code></pre>

<p>注意, 单个 <code>%</code> 是非贪婪操作, 想要贪婪式的, 则使用 <code>%%</code>
类似的, 还有 <code>#</code> 是非贪婪的, 而 <code>##</code> 是贪婪的.</p>

<h1 id="并行操作">并行操作</h1>

<p>在循环里的命令, 使用 <code>&amp;</code> 时, 它就会直接向下再执行了, 而不会等待命令执行完成.这样子就可以利用多核</p>

<pre><code class="language-bash">#!/bin/bash

PIDARRAY=()

for file in File1.iso File2.iso
do
	md5sum $file &amp;
    PIDARRAY+=(&quot;$!&quot;)
done

wait ${PIDARRAY[@]}
</code></pre>

<p>注意, 还要用 wait 来等待多进程的退出.</p>

<h1 id="dd-命令">dd 命令</h1>

<pre><code class="language-bash">dd if=/dev/zero of=data.file bs=1M count1
</code></pre>

<h1 id="不可删除的文件">不可删除的文件</h1>

<pre><code class="language-bash">chattr +i file

删除的时候, 它会提示

rm: remove write-protected regular empty file 'file'?
</code></pre>

<p>恢复为可删除</p>

<pre><code class="language-bash">chattr -i file
</code></pre>

<h1 id="diff-与文件补丁-patch">diff 与文件补丁 patch</h1>

<pre><code class="language-bash">diff -u version1.txt version2.txt &gt; version.patch
</code></pre>

<p>patch 命令可将修改应用于任意文件. 当应用于 <code>version1.txt</code> 时, 就可以得到 <code>version2.txt</code> , 当应用于 <code>version2.txt</code> 时, 就可以得到 <code>version1.txt</code></p>

<pre><code class="language-bash">patch -p1 version1.txt &lt; version.patch

取消修改

patch -p1 version1.txt &lt; version.patch
</code></pre>

<p>递归的形式来处理目录及文件</p>

<pre><code class="language-bash">diff -Naur dir2 dir2
</code></pre>

<h1 id="快速定位目录">快速定位目录</h1>

<pre><code class="language-bash">pushd 压入

popd 弹出

dirs 查看栈的内容

cd - 返回上一次的目录
</code></pre>

<p>它是一个处理LIFO的数据结构. 目录被存储在栈中, 然后 push 和 pop 进行切换.</p>

<h1 id="wc-命令">wc 命令</h1>

<pre><code class="language-bash">wc -l file # 统计文件 file 的行数
wc -w file # 单词数
wc -c file # 字符数
wc file # 行数, 单词数, 字符数
wc file -L # 最长一行的长度
</code></pre>

<h1 id="正则">正则</h1>

<p><a href="https://regexper.com">可视化正则</a></p>

<pre><code class="language-bash">| 正则   | 描述                            |
|--------|---------------------------------|
| ^      | 行起始标记                      |
| $      | 行结尾标记                      |
| .      | 任意一个字符                    |
| []     | 在 [] 中的任意一个字符          |
| [^]    | 在 [^] 之外的任意一个字符       |
| [-]    | 在 [-] 指定范围内的任意一个字符 |
| ?      | 匹配之前的项1次或0次            |
| +      | 匹配之前的项1次或多次           |
| *      | 匹配之前的项0次或多次           |
| ()     | 创建一个用于匹配的子串          |
| {n}    | 匹配之前的项n次                 |
| {n, }  | 匹配之前项至少n次               |
| {n, m} | 匹配之前项n到m次                |
| \      | 转义                            |
| 一竖     | 匹配两边任意一项                        |
</code></pre>

<h1 id="cut-命令">cut 命令</h1>

<blockquote>
<p>按列切分</p>
</blockquote>

<h2 id="提取指定列">提取指定列</h2>

<pre><code class="language-bash">cut -f 2,3 filename
</code></pre>

<p>这列表只显示第2,3列</p>

<h2 id="排除指定列">排除指定列</h2>

<pre><code class="language-bash">cut -f3 --complement filename
</code></pre>

<p>这表示除第3列之外的所有列.</p>

<h2 id="指定界定符">指定界定符</h2>

<pre><code class="language-bash">cut -d &quot;;&quot; filename
</code></pre>

<h2 id="指定字段的字符或字节范围">指定字段的字符或字节范围</h2>

<pre><code class="language-bash">cut -c1-5 filename
</code></pre>

<p>表示只打印前1~5个字符.</p>

<h1 id="sed-命令">sed 命令</h1>

<blockquote>
<p>stream editor</p>
</blockquote>

<h2 id="替换字符串">替换字符串</h2>

<pre><code class="language-bash">sed 's/pattern/replace_string/' file
</code></pre>

<h2 id="应用到文件">应用到文件</h2>

<pre><code class="language-bash">sed -i 's/pattern/replace_string/' file
</code></pre>

<h2 id="全局应用">全局应用</h2>

<p>默认情况下, sed 将在每一行的第一处符合的内容替换. 要全部则:</p>

<pre><code class="language-bash">sed 's/pattern/replace_string/g' file
</code></pre>

<p>只在第N处开始替换</p>

<pre><code class="language-bash">sed 's/pattern/replace_string/2g' file
</code></pre>

<h2 id="界定符">界定符</h2>

<p>除了 <code>/</code> 还可以:</p>

<pre><code class="language-bash">sed 's:text:replace:g'

sed 's|text|replace|g'
</code></pre>

<h2 id="移除空白行">移除空白行</h2>

<pre><code class="language-bash">sed '/^$/d' file
</code></pre>

<h1 id="awk">awk</h1>

<pre><code class="language-bash">awk '{BEGIN {print &quot;start&quot;} pattern {commands} END {print &quot;end&quot;}}' file
</code></pre>

<p>处理流程:</p>

<ol>
<li>执行 BEGIN {commands} 语句块中的语句</li>
<li>从文件或stdin 中读取一行, 然后执行 pattern {commands} , 重复这个过程, 直接文件全部被读取完.</li>
<li>当读至输入流末尾时, 执行 END {commands} 语句块.</li>
</ol>

<h2 id="特殊变量">特殊变量</h2>

<ul>
<li>NR : 当前行号</li>
<li>NF : 当前行的字段数</li>
<li>$0 : 当前行的内容</li>
<li>$1 : 第一个字段的内容</li>
<li>$2 : 第二个字段的内容</li>
</ul>

<h2 id="将外部变量传递给-awk">将外部变量传递给 awk</h2>

<pre><code class="language-bash">awk -v VAR=$OUT_VAR '{print VAR}'
</code></pre>

<h2 id="设置字段界定符">设置字段界定符</h2>

<pre><code class="language-bash">awk -F: '{print $1}'
</code></pre>

<p>这样子, 就将字符界定符设置为 <code>:</code> 了.</p>

<h2 id="内建函数">内建函数</h2>

<p><a href="ftp://ftp.gnu.org/old-gnu/Manuals/gawk-3.0.3/html_chapter/gawk_13.html">gnu awk</a></p>

<pre><code class="language-bash">length(string) : 返回字符串的长度
</code></pre>

<h1 id="paste-命令-列拼接">paste 命令:列拼接</h1>

<p>cat 是按行拼接的.</p>

<p>paste 则是按列来拼接的.</p>

<h1 id="tac">tac</h1>

<p>逆序显示. cat 的逆单词.</p>

<h1 id="wget">wget</h1>

<blockquote>
<p>命令行下载工具</p>
</blockquote>

<h2 id="指定多个下载">指定多个下载</h2>

<pre><code class="language-bash">wget URL1 URL2
</code></pre>

<h2 id="指定输出文件">指定输出文件</h2>

<pre><code class="language-bash">wget URL1 -O outputfile -o logfile
</code></pre>

<h2 id="重试次数">重试次数</h2>

<pre><code class="language-bash">wget -t 5 URL1
</code></pre>

<p>为0时, 表示无限重试.</p>

<h2 id="限速">限速</h2>

<pre><code class="language-bash">wget --limit-rate 20k URL
</code></pre>

<h2 id="最大下载配额">最大下载配额</h2>

<pre><code class="language-bash">wget -Q 100m URL
</code></pre>

<p>表示最大下载 100m 大小, 超过时就会停止.</p>

<h2 id="断点续传">断点续传</h2>

<pre><code class="language-bash">wget -c URL
</code></pre>

<h2 id="复制整个网站">复制整个网站</h2>

<pre><code class="language-bash">wget --mirror --covert-links URL
</code></pre>

<h1 id="curl-命令">curl 命令</h1>

<h2 id="避免显示进度">避免显示进度</h2>

<pre><code class="language-bash">curl --silent URL
</code></pre>

<h2 id="下载">下载</h2>

<pre><code class="language-bash">curl URL --silent -O
</code></pre>

<h2 id="型进度条"><code>#</code> 型进度条</h2>

<pre><code class="language-bash">curl URL --progress
</code></pre>

<h2 id="断点续传-1">断点续传</h2>

<pre><code class="language-bash">curl -C - URL
</code></pre>

<p><code>-C -</code> 表示让 curl 自动计算.</p>

<h2 id="设置-referer">设置 referer</h2>

<pre><code class="language-bash">curl --referer referer_url URL
</code></pre>

<h2 id="设置-cookie">设置 cookie</h2>

<p><a href="https://curl.haxx.se/docs/http-cookies.html">doc</a></p>

<pre><code class="language-bash">curl --cookie &quot;k=v;k1=v1&quot;
</code></pre>

<h2 id="将-cookie-另存为文件">将 cookie 另存为文件</h2>

<pre><code class="language-bash">curl URL --cookie-jar cookie_file
或简写
curl URL -c cookie_file
</code></pre>

<h2 id="请求时-带上cookie文件中的cookie">请求时, 带上cookie文件中的cookie</h2>

<pre><code class="language-bash">curl URL -b cookie_file
</code></pre>

<h2 id="限制带宽">限制带宽</h2>

<pre><code class="language-bash">curl URL --limit-rate 20k
</code></pre>

<h2 id="只打印头部">只打印头部</h2>

<pre><code class="language-bash">curl -I URL
</code></pre>

<h1 id="tar-命令">tar 命令</h1>

<pre><code class="language-bash">打包并压缩
tar -cvjf file.tar.bz2 file1 fiel2
tar -cvzf file.tar.gz file1 file2

解压
tar -xvjf file.tar.bz2
tar -xvzf file.tar.gz
</code></pre>

<h1 id="rsync-命令">rsync 命令</h1>

<pre><code class="language-bash">rsync -avzh source_path dest_path

rsync -avzh -e &quot;ssh -p 22&quot; remote_path dest_path
</code></pre>

<h2 id="排除">排除</h2>

<pre><code class="language-bash">rsync --exclude &quot;*.txt&quot;
</code></pre>

<h2 id="同步时在dest-path中删除源端不存在的文件">同步时在dest_path中删除源端不存在的文件</h2>

<pre><code class="language-bash">rsync --delete
</code></pre>

<h1 id="fsarchiver-命令">fsarchiver 命令</h1>

<blockquote>
<p>制作全盘镜像</p>
</blockquote>

<h2 id="创建">创建</h2>

<pre><code class="language-bash">fsarchiver savefs backup.fsa /dev/sda1

多个分区同时备份
fsarchiver savefs backup.fsa /dev/sda1 /dev/sda2
</code></pre>

<h2 id="恢复">恢复</h2>

<pre><code class="language-bash">fsarchiver restfs backup.fsa id=0,dest=/dev/sda1 id=1,dest=/dev/sdb2
</code></pre>

<h2 id="脚本中使用-eof-的-raw-string">脚本中使用 EOF 的 raw string</h2>

<pre><code class="language-bash">IFS='' read -r -d '' String &lt;&lt;&quot;EOF&quot;
&lt;?xml version=&quot;1.0&quot; encoding='UTF-8'?&gt;
 &lt;painting&gt;
   &lt;img src=&quot;madonna.jpg&quot; alt='Foligno Madonna, by Raphael'/&gt;
   &lt;caption&gt;This is Raphael's &quot;Foligno&quot; Madonna, painted in
   &lt;date&gt;1511&lt;/date&gt;-&lt;date&gt;1512&lt;/date&gt;.&lt;/caption&gt;
 &lt;/painting&gt;
EOF
</code></pre>

    </div>

    
    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">emacsist</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">2017-12-31</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>

    
    
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">Reward</label>
  <div class="qr-code">
    
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/img/wxpay.jpeg">
        <span>wechat</span>
      </label>
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/img/alipay.jpeg">
        <span>alipay</span>
      </label>
  </div>
</div>

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/bash/">bash</a>
          
          <a href="/tags/linux/">linux</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="https://emacsist.github.io/2018/01/03/%E6%9D%8E%E6%9D%80%E7%9A%84elisp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">李杀的Elisp学习笔记</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="https://emacsist.github.io/2017/12/29/java-web-%E4%B8%AD%E5%8A%A8%E6%80%81%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7%E5%80%BC/">
            <span class="next-text nav-default">Java Web 中动态修改配置文件属性值</span>
            <span class="prev-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  <div id="comments-gitment"></div>
  <link rel="stylesheet" href="/lib/gitment/gitment-0.0.3.min.css">
    <script src="/lib/gitment/gitment-0.0.3.min.js"></script>
  <script type="text/javascript">
  const gitment = new Gitment({
    id: '2017-12-31 21:59:39 \x2b0000 UTC',
    title: '\x3cLinux Shell 脚本攻略\x3e学习笔记',
    link: decodeURI(location.href),
    desc: 'shebang wiki 在计算机科学中，Shebang（也称为 Hashbang ）是一个由井号和',
    owner: 'emacsist',
    repo: 'emacsist.github.io',
    oauth: {
      client_id: 'd1456501fba5329f3afa',
      client_secret: 'd1ecbb7929a49de947215701320c60b312a72d3a'
    }
  })
  gitment.render('comments-gitment')
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://github.com/imsun/gitment">comments powered by gitment.</a></noscript>

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:emacsist@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://twitter.com/emacsist2016" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://plus.google.com/u/0/114200054463267049438" class="iconfont icon-google" title="google"></a>
      <a href="https://github.com/emacsist" class="iconfont icon-github" title="github"></a>
      <a href="https://www.zhihu.com/people/emacist" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://www.douban.com/people/emacsist/" class="iconfont icon-douban" title="douban"></a>
  <a href="https://emacsist.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
    <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>


  <span class="copyright-year">
    &copy; 
    
      2014 - 
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">emacsist</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  
<script type="text/javascript" src="/dist/even.min.js?v=3.1.1"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-118327923-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>









<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1278300546'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1278300546%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</body>
</html>
