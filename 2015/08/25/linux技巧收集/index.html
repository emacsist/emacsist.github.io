<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Linux技巧收集 - emacsist</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="emacsist" />
  <meta name="description" content="获取外网IP PUBLIC_IP=`wget http://ipecho.net/plain -O - -q ; echo` echo $PUBLIC_IP 直接显示: wget http://ipecho.net/plain -O - -q ; echo 查找历史命令 Ctrl&#43;R 搜索 从当前目录，递归搜索&amp;rdquo;10.0.0.40&amp;rdquo;这" />

  <meta name="keywords" content="Golang, Java, PostgreSQL, Postgres, MySQL, emacsist, RabbitMQ, Go, emacs, orgmode" />






<meta name="generator" content="Hugo 0.54.0" />


<link rel="canonical" href="https://emacsist.github.io/2015/08/25/linux%E6%8A%80%E5%B7%A7%E6%94%B6%E9%9B%86/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<link href="/dist/even.min.css?v=3.1.1" rel="stylesheet">





<meta property="og:title" content="Linux技巧收集" />
<meta property="og:description" content="获取外网IP PUBLIC_IP=`wget http://ipecho.net/plain -O - -q ; echo` echo $PUBLIC_IP 直接显示: wget http://ipecho.net/plain -O - -q ; echo 查找历史命令 Ctrl&#43;R 搜索 从当前目录，递归搜索&rdquo;10.0.0.40&rdquo;这" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://emacsist.github.io/2015/08/25/linux%E6%8A%80%E5%B7%A7%E6%94%B6%E9%9B%86/" />
<meta property="article:published_time" content="2015-08-25T11:48:05&#43;00:00"/>
<meta property="article:modified_time" content="2015-08-25T11:48:05&#43;00:00"/>

<meta itemprop="name" content="Linux技巧收集">
<meta itemprop="description" content="获取外网IP PUBLIC_IP=`wget http://ipecho.net/plain -O - -q ; echo` echo $PUBLIC_IP 直接显示: wget http://ipecho.net/plain -O - -q ; echo 查找历史命令 Ctrl&#43;R 搜索 从当前目录，递归搜索&rdquo;10.0.0.40&rdquo;这">


<meta itemprop="datePublished" content="2015-08-25T11:48:05&#43;00:00" />
<meta itemprop="dateModified" content="2015-08-25T11:48:05&#43;00:00" />
<meta itemprop="wordCount" content="2315">



<meta itemprop="keywords" content="linux," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Linux技巧收集"/>
<meta name="twitter:description" content="获取外网IP PUBLIC_IP=`wget http://ipecho.net/plain -O - -q ; echo` echo $PUBLIC_IP 直接显示: wget http://ipecho.net/plain -O - -q ; echo 查找历史命令 Ctrl&#43;R 搜索 从当前目录，递归搜索&rdquo;10.0.0.40&rdquo;这"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">emacsist</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">emacsist</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Linux技巧收集</h1>

      <div class="post-meta">
        <span class="post-time"> 2015-08-25 </span>
        <div class="post-category">
            
              <a href="/categories/linux/"> linux </a>
            
          </div>
        <span class="more-meta"> 2315 words </span>
        <span class="more-meta"> 5 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li><a href="#获取外网ip">获取外网IP</a></li>
<li><a href="#查找历史命令">查找历史命令</a></li>
<li><a href="#搜索">搜索</a></li>
<li><a href="#毫秒转换成日期">毫秒转换成日期：</a></li>
<li><a href="#十六进制转十进制">十六进制转十进制</a></li>
<li><a href="#十进制转十六进制">十进制转十六进制</a></li>
<li><a href="#运行进程与session不挂勾">运行进程与session不挂勾</a></li>
<li><a href="#查看某进程监听的端口">查看某进程监听的端口</a></li>
<li><a href="#统计代码行数">统计代码行数</a></li>
<li><a href="#统计列的总和">统计列的总和</a></li>
<li><a href="#清除日志的脚本">清除日志的脚本</a>
<ul>
<li><a href="#除了指定的文件名不处理">除了指定的文件名不处理</a></li>
</ul></li>
<li><a href="#find-1天以前修改的文件">find 1天以前修改的文件</a></li>
<li><a href="#find-1天之内修改的文件">find 1天之内修改的文件</a></li>
<li><a href="#mv-命令在脚本里的使用">mv 命令在脚本里的使用</a></li>
<li><a href="#删除匹配的字符串之间的行">删除匹配的字符串之间的行</a></li>
<li><a href="#查看进程启动时间">查看进程启动时间</a></li>
<li><a href="#grep包含-的使用">grep包含\的使用</a></li>
<li><a href="#显示每个进程的swap使用量">显示每个进程的SWAP使用量</a></li>
<li><a href="#bash-00-23-遍历">Bash 00-23 遍历</a></li>
<li><a href="#tar-忽略某文件或目录">tar 忽略某文件或目录</a></li>
<li><a href="#删除子字符串">删除子字符串</a></li>
<li><a href="#将秒数批量显示为日期">将秒数批量显示为日期</a></li>
<li><a href="#在指定正则表达式的文件里搜索内容">在指定正则表达式的文件里搜索内容</a></li>
<li><a href="#批量重命名">批量重命名</a></li>
<li><a href="#同步文件-然后再删除源文件">同步文件,然后再删除源文件</a></li>
<li><a href="#iptable-禁止外网访问某端口">iptable 禁止外网访问某端口</a></li>
<li><a href="#开机自动使iptables生效">开机自动使iptables生效</a></li>
<li><a href="#归档日志-并删除源文件">归档日志, 并删除源文件</a></li>
<li><a href="#rsync同步文件后并删除源文件">rsync同步文件后并删除源文件</a></li>
<li><a href="#在文件的开头添加内容">在文件的开头添加内容</a></li>
<li><a href="#替换字符串">替换字符串</a></li>
<li><a href="#查找文件的创建时间">查找文件的创建时间</a></li>
<li><a href="#同步tomcat">同步Tomcat</a></li>
<li><a href="#按自然排序">按自然排序</a></li>
<li><a href="#搜索文件然后对它进行处理">搜索文件然后对它进行处理</a></li>
<li><a href="#并-差-交集">并，差，交集</a>
<ul>
<li><a href="#并集">并集</a></li>
<li><a href="#交集">交集</a></li>
<li><a href="#差集">差集</a></li>
</ul></li>
<li><a href="#查看gcc搜索头文件的路径-xxx-h">查看gcc搜索头文件的路径 xxx.h</a></li>
<li><a href="#解压zip到指定文件名">解压zip到指定文件名</a></li>
<li><a href="#enter-passphrase-for-key">Enter passphrase for key</a></li>
<li><a href="#将当前目录下的所有-git-仓库-pull-当前分支的最新代码">将当前目录下的所有 git 仓库 pull 当前分支的最新代码</a></li>
<li><a href="#列出所有正在监听的端口">列出所有正在监听的端口</a></li>
<li><a href="#grep-某进程-然后kill掉">grep 某进程，然后kill掉</a></li>
<li><a href="#检查磁盘是否是ssd">检查磁盘是否是SSD</a></li>
<li><a href="#查看网速">查看网速</a></li>
<li><a href="#logrotate-使用">logrotate 使用</a></li>
<li><a href="#grep-以文件的形式保存匹配-pattern">grep 以文件的形式保存匹配 pattern</a></li>
<li><a href="#grep-curl-的输出">grep curl 的输出</a></li>
<li><a href="#根据-pid-来查找它所占用的端口">根据 PID 来查找它所占用的端口</a></li>
<li><a href="#查找空文件并删除">查找空文件并删除</a></li>
<li><a href="#grep-正则匹配中括号的内容-非贪婪模式">grep 正则匹配中括号的内容(非贪婪模式)</a></li>
<li><a href="#统计各tcp连接状态的数量">统计各TCP连接状态的数量</a></li>
<li><a href="#统计进程打开的文件句柄数">统计进程打开的文件句柄数</a></li>
<li><a href="#tar-打包">tar 打包</a></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<h1 id="获取外网ip">获取外网IP</h1>

<pre><code class="language-bash">PUBLIC_IP=`wget http://ipecho.net/plain -O - -q ; echo`
echo $PUBLIC_IP

直接显示:
wget http://ipecho.net/plain -O - -q ; echo
</code></pre>

<h1 id="查找历史命令">查找历史命令</h1>

<pre><code class="language-bash">Ctrl+R
</code></pre>

<h1 id="搜索">搜索</h1>

<p>从当前目录，递归搜索&rdquo;10.0.0.40&rdquo;这个词</p>

<pre><code class="language-bash">grep -rnw . -e &quot;10.0.0.40&quot;
</code></pre>

<h1 id="毫秒转换成日期">毫秒转换成日期：</h1>

<pre><code class="language-bash">date -d @$(  echo &quot;(1445930011000 + 500) / 1000&quot; | bc)
</code></pre>

<h1 id="十六进制转十进制">十六进制转十进制</h1>

<pre><code class="language-bash">echo $((0xa))

10
</code></pre>

<h1 id="十进制转十六进制">十进制转十六进制</h1>

<pre><code class="language-bash">printf &quot;%x\n&quot; 10

a
➜  ~
</code></pre>

<h1 id="运行进程与session不挂勾">运行进程与session不挂勾</h1>

<pre><code class="language-bash">nohup idea.sh &gt; /dev/null 2&gt;&amp;1 &amp;
</code></pre>

<h1 id="查看某进程监听的端口">查看某进程监听的端口</h1>

<pre><code class="language-bash">sudo ss -l -p -n | grep PID

sudo lsof -Pan -p PID -i

</code></pre>

<h1 id="统计代码行数">统计代码行数</h1>

<pre><code class="language-bash">find . -name &quot;*.java&quot; | xargs -P 0 wc -l | sort -k1 -n

不包括空行
find . -name &quot;*.java&quot; | xargs -P 0 sed '/^\s*$/d' | wc -l
</code></pre>

<h1 id="统计列的总和">统计列的总和</h1>

<pre><code class="language-bash">awk '{ sum+=$1} END {print sum}'
</code></pre>

<h1 id="清除日志的脚本">清除日志的脚本</h1>

<pre><code class="language-bash">#!/bin/bash
set -x

cd /tmp/test/

FILE_N=&quot;delete.file.list&quot;

find . -type f \( -iname \*.log -o -iname \*.txt \) &gt; ${FILE_N}
cat ${FILE_N} | xargs -t -n 1 -I {} -P 0 bash -c &quot;split -d --bytes=100M --filter='gzip &gt; \$FILE.gz' {} {} &amp;&amp; rm -rf {}&quot;

</code></pre>

<h2 id="除了指定的文件名不处理">除了指定的文件名不处理</h2>

<p><code>! -iname access.log</code></p>

<pre><code class="language-bash">#!/bin/bash
set -x

cd /tmp/test/

FILE_N=&quot;delete.file.list&quot;

find . -type f \( ! -iname access.log -iname \*.log -o -iname \*.txt \) &gt; ${FILE_N}
cat ${FILE_N} | xargs -t -n 1 -I {} -P 0 bash -c &quot;split -d --bytes=100M --filter='gzip &gt; \$FILE.gz' {} {} &amp;&amp; rm -rf {}&quot;
</code></pre>

<h1 id="find-1天以前修改的文件">find 1天以前修改的文件</h1>

<pre><code class="language-bash">find -mtime +1

</code></pre>

<h1 id="find-1天之内修改的文件">find 1天之内修改的文件</h1>

<pre><code class="language-bash">find -mtime -1
</code></pre>

<h1 id="mv-命令在脚本里的使用">mv 命令在脚本里的使用</h1>

<pre><code class="language-bash">cat ${MOVE_FILE_NAME} | xargs -t -n 1 -I {} -P 0 dirname {} | sort -u | xargs -t -n 1 -I {} -P 0 bash -c &quot;mv {}/*.sync.gz \&quot;${SAVE_DIR}{}/\&quot;&quot;
</code></pre>

<h1 id="删除匹配的字符串之间的行">删除匹配的字符串之间的行</h1>

<pre><code class="language-bash">#直接修改文件
sed -i '/no task start/,/no task end/d' ${ROOT}/target/ROOT/WEB-INF/classes/spring.xml

#不修改文件，只是将修改后的结果输出到stdout中
sed '/no task start/,/no task end/d' ${ROOT}/target/ROOT/WEB-INF/classes/spring.xml
</code></pre>

<h1 id="查看进程启动时间">查看进程启动时间</h1>

<pre><code class="language-bash">ps -p 25517  -o lstart
</code></pre>

<h1 id="grep包含-的使用">grep包含\的使用</h1>

<pre><code class="language-bash">有段数据，内容如下：
sdfsdf2e\x22bidfloor\x22:800,sldkfjsldkfslflsdf

然后想 grep 出 bidfloor\x22:800 这个内容，可以这样子:
cat test.file | grep -o &quot;bidfloor\\\\\x22:[0-9]*&quot;

注意，是5个\，即4个\加上\x22内容本身
</code></pre>

<h1 id="显示每个进程的swap使用量">显示每个进程的SWAP使用量</h1>

<pre><code class="language-bash">for file in /proc/*/status ; do awk '/VmSwap|Name|^Pid:/{printf $1 &quot; &quot; $2 &quot; &quot; $3 &quot; &quot; $4 &quot; &quot; $5 &quot; &quot; $6}END{ print &quot;&quot;}' $file; done | sort -k 6 -n -r | less
</code></pre>

<h1 id="bash-00-23-遍历">Bash 00-23 遍历</h1>

<pre><code class="language-bash">for i in {00..23}; do
	echo ${i}
done
</code></pre>

<h1 id="tar-忽略某文件或目录">tar 忽略某文件或目录</h1>

<pre><code class="language-bash">tar -cvjf /path/to/xxx.tar.bz2 /path/to/backup --exclude=/path/to/dir --exclude=/path/to/file
</code></pre>

<p>注意，忽略目录时，目录的结尾不能有<code>/</code>结尾.</p>

<h1 id="删除子字符串">删除子字符串</h1>

<pre><code class="language-bash">从字符串string开头匹配pattern，并将匹配的删除
${string#pattern}

从字符串string结尾开始匹配pattern，并将匹配的删除
${string%pattern}

</code></pre>

<h1 id="将秒数批量显示为日期">将秒数批量显示为日期</h1>

<pre><code class="language-bash">cat dd | grep -o &quot;^[0-9]*&quot; | xargs -n 1 -I{} echo {} | xargs -n 1 -P 1 -t -I{} date -d @{}
</code></pre>

<p>文件<code>dd</code>的内容如下:</p>

<pre><code class="language-bash">1465712640
1465638231
...
</code></pre>

<h1 id="在指定正则表达式的文件里搜索内容">在指定正则表达式的文件里搜索内容</h1>

<pre><code class="language-bash">time grep -rnw console_2016-06-14.1[0-9][0-9]*.log  -e &quot;清除&quot;
</code></pre>

<h1 id="批量重命名">批量重命名</h1>

<pre><code class="language-bash">╭─sky@sky-linux /tmp/testbash  
╰─➤  ls
hello1.txt  hello2.txt  hello3.txt  hello4.txt  hello5.txt  hello6.txt  hello7.txt

将hello改为hello-new

╭─sky@sky-linux /tmp/testbash  
╰─➤  rename 's/hello/hello-new/' *.txt

╭─sky@sky-linux /tmp/testbash  
╰─➤  ls
hello-new1.txt  hello-new2.txt  hello-new3.txt  hello-new4.txt  hello-new5.txt  hello-new6.txt  hello-new7.txt
</code></pre>

<h1 id="同步文件-然后再删除源文件">同步文件,然后再删除源文件</h1>

<p>比如,我们想将日志文件迁移到某台服务器后,再删除源文件,以减轻磁盘占用空间.</p>

<pre><code class="language-bash">#!/usr/bin/env bash

DEST_PORT=1850
DEST_DIR=&quot;/tmp/logs&quot;
DEST_IP=&quot;1.2.3.4&quot;
DEST_USER=&quot;sky&quot;


SOURCE_DIR=&quot;/home/sky/share/unknown&quot;
SOURCE_SUFFIX=&quot;*&quot;


find ${SOURCE_DIR}  -mtime +1  -name &quot;*.${SOURCE_SUFFIX}&quot; | xargs -n 1 -I{} -P 2 rsync -R --remove-source-files -avzh &quot;-e ssh -p ${DEST_PORT}&quot; {} ${DEST_USER}@${DEST_IP}:${DEST_DIR}

如果有多个后缀的话,那要写成如下的形式

find . -mtime +1 -name &quot;*.log&quot; -o -mtime +1  -name &quot;*.zip&quot;

再如:

find /home/sky/tomcat/ -path &quot;*logs*&quot; -mtime +1 -name &quot;*.log&quot;  -o -path &quot;*logs*&quot; -mtime +1 -name &quot;*.txt&quot;  -o -path &quot;*logs*&quot; -mtime +1 -name &quot;*.tmp&quot;  | xargs -n 1 -P2 -I{} tar --remove-files -cvjf {}.tar.bz2 {} &gt;&gt; /tmp/compress.log
</code></pre>

<h1 id="iptable-禁止外网访问某端口">iptable 禁止外网访问某端口</h1>

<p>eth1:就是外网所在的网卡号,请用 <code>ifconfig</code> 来查看.</p>

<pre><code class="language-bash">sudo iptables -t filter -i eth1 -A INPUT -p tcp --dport 6606 -j REJECT
sudo iptables -t filter -i eth1 -A INPUT -p udp --dport 6606 -j REJECT
</code></pre>

<h1 id="开机自动使iptables生效">开机自动使iptables生效</h1>

<pre><code class="language-bash">sudo apt-get install iptables-persistent
</code></pre>

<p>如果修改了iptables的话, 要做如下修改:</p>

<pre><code class="language-bash">sudo su -c 'iptables-save &gt; /etc/iptables/rules.v4'
sudo su -c 'ip6tables-save &gt; /etc/iptables/rules.v6'
</code></pre>

<h1 id="归档日志-并删除源文件">归档日志, 并删除源文件</h1>

<pre><code class="language-bash">nohup bash -c &quot; ls console_2016-06-30.*.log  | xargs -n 1 -P2 -I{} tar --remove-files -cvjf {}.tar.bz2 {} &quot; &gt; ~/compress-log.log &amp;
</code></pre>

<h1 id="rsync同步文件后并删除源文件">rsync同步文件后并删除源文件</h1>

<pre><code class="language-bash">nohup bash -c &quot; find /home/yourname/tomcat/logs/ -name \&quot;*_[0-9][0-9][0-9][0-9]-*.log\&quot;  | xargs -n 1 -P2 -I{} tar --remove-files -cvjf {}.tar.bz2 {} &quot; &gt;&gt; /tmp/compress.log &amp;


nohup bash -c &quot; find /home/yourname/tomcat/logs/ -name \&quot;*.bz2\&quot;  | xargs -n 1 -P2 -I{} rsync -e \&quot;ssh -p 你的ssh端口\&quot; -avzh -R --remove-source-files {} yourname@yourIP:/remote/server/path &quot; &gt;&gt; /tmp/rsync.log &amp;

-R参数:表示相对在 /remote/server/path 目录下,再创建与源目录的相对路径.比如, 上同这样子,就会在远程服务器上创建如下类似的结构:

/remote/server/path/home/yourname/tomcat/logs
</code></pre>

<h1 id="在文件的开头添加内容">在文件的开头添加内容</h1>

<pre><code class="language-bash">╭─sky@sky-linux /tmp  
╰─➤  echo &quot;hsdlf&quot; &gt; hello.txt
╭─sky@sky-linux /tmp  
╰─➤  sed -i &quot;1iWorld&quot; hello.txt 
╭─sky@sky-linux /tmp  
╰─➤  cat hello.txt 
World
hsdlf
╭─sky@sky-linux /tmp  
╰─➤  
</code></pre>

<h1 id="替换字符串">替换字符串</h1>

<pre><code class="language-bash">将所有'0000-00-00 00:00:00替换为 1998-07-01 00:00:00'

sed -i &quot;s/0000-00-00 00:00:00/1998-07-01 00:00:00/g&quot; wb_status.data
</code></pre>

<h1 id="查找文件的创建时间">查找文件的创建时间</h1>

<pre><code class="language-bash"># 查找文件的inode号码
ls -i file

# 根据inode来查看文件的crtime
╭─sky@sky-linux /ihome/db/postgresql/current/data/base/16384  
╰─➤  sudo debugfs -R 'stat &lt;3022225&gt;' /dev/sda1 
[sudo] password for sky: 
debugfs 1.42.9 (4-Feb-2014)
</code></pre>

<h1 id="同步tomcat">同步Tomcat</h1>

<pre><code class="language-bash">
</code></pre>

<h1 id="按自然排序">按自然排序</h1>

<pre><code class="language-bash">cat /tmp/xxx.log| sort -k4n
</code></pre>

<h1 id="搜索文件然后对它进行处理">搜索文件然后对它进行处理</h1>

<pre><code class="language-bash">find . -name &quot;*.js&quot; -o -name &quot;*.html&quot; -o -name &quot;*.map&quot; -print0 -type f | xargs -0  sed -i 's/hello/world/g'
</code></pre>

<h1 id="并-差-交集">并，差，交集</h1>

<h2 id="并集">并集</h2>

<pre><code class="language-bash">sort a.txt b.txt | uniq
</code></pre>

<h2 id="交集">交集</h2>

<pre><code class="language-bash">sort a.txt b.txt | uniq -d
</code></pre>

<p><code>-d</code>表示显示有重复的</p>

<h2 id="差集">差集</h2>

<pre><code class="language-bash">sort a.txt b.txt b.txt | uniq -u
</code></pre>

<p><code>-u</code>表示只显示没有重复的.</p>

<h1 id="查看gcc搜索头文件的路径-xxx-h">查看gcc搜索头文件的路径 xxx.h</h1>

<pre><code class="language-bash">gcc -v -E -
</code></pre>

<h1 id="解压zip到指定文件名">解压zip到指定文件名</h1>

<pre><code class="language-bash">unzip -p xxx.zip &gt; hello.file
</code></pre>

<h1 id="enter-passphrase-for-key">Enter passphrase for key</h1>

<pre><code class="language-bash">$ eval `ssh-agent -s`
$ ssh-add ~/.ssh/id_rsa_key
$ ssh-add -l
$ ssh  your-server
</code></pre>

<p>也可以将这些放到bashrc文件中.</p>

<h1 id="将当前目录下的所有-git-仓库-pull-当前分支的最新代码">将当前目录下的所有 git 仓库 pull 当前分支的最新代码</h1>

<pre><code class="language-bash">ls | xargs -I{} -n 1 bash -c &quot;cd {};git pull origin \&quot;$(git branch | grep -E '^\* ' | sed 's/^\* //g')\&quot;;git fetch --all&quot;
</code></pre>

<h1 id="列出所有正在监听的端口">列出所有正在监听的端口</h1>

<pre><code class="language-bash">
sudo lsof -iTCP -sTCP:LISTEN

</code></pre>

<h1 id="grep-某进程-然后kill掉">grep 某进程，然后kill掉</h1>

<pre><code class="language-bash">
ps -ef | grep PROCESS | grep -v grep | awk '{print $2}' | xargs kill -9

</code></pre>

<h1 id="检查磁盘是否是ssd">检查磁盘是否是SSD</h1>

<pre><code class="language-bash">
cat /sys/block/sda/queue/rotational

0：是SSD，1是HDD
或

sudo smartctl -a /dev/sdb
如果看到
Rotation Rate:    Solid State Device
就表明是SSD

</code></pre>

<h1 id="查看网速">查看网速</h1>

<pre><code class="language-bash">sar -n DEV 1 100
</code></pre>

<p>1：间隔1秒
100：共100次</p>

<h1 id="logrotate-使用">logrotate 使用</h1>

<p><a href="http://linuxcommand.org/man_pages/logrotate8.html">logrotate</a></p>

<p><a href="https://linux.die.net/man/8/logrotate">logrotate linux.die.net</a></p>

<p>一个小例子:</p>

<pre><code class="language-bash">/home/emacsist/nginx/nginx-1.9.3/logs/*.log {
  daily
  compress
  nodelaycompress
  rotate 100
  size 1M
  notifempty
  missingok
  nocreate
  sharedscripts
  postrotate
    test ! -f /home/emacsist/nginx/nginx-1.9.3/logs/nginx.pid || kill -USR1 `cat /home/emacsist/nginx/nginx-1.9.3/logs/nginx.pid`
  endscript
}
</code></pre>

<p>多个文件和目录的话:</p>

<pre><code class="language-bash">/var/log/basedir/*.log /var/log/basedir/*/*.log {
    daily
    rotate 5
}
</code></pre>

<p>处理 tomcat 日志</p>

<pre><code class="language-bash">/home/yourUserName/tomcat/*/logs/catalina.out /home/yourUserName/tomcat/*/logs/*.log /home/yourUserName/tomcat/*/logs/*/*.log {
  copytruncate
  daily
  rotate 1000
  size 1M
  notifempty
  compress
  nodelaycompress
  missingok
  su yourUserName yourUserName
}
</code></pre>

<p><code>size</code> 只有比这个大小大的才处理. <code>M</code>(大写M, 不是MB), <code>G</code>, <code>k</code> (小写k)</p>

<h1 id="grep-以文件的形式保存匹配-pattern">grep 以文件的形式保存匹配 pattern</h1>

<pre><code class="language-bash">grep -f pattern.file target.file
</code></pre>

<h1 id="grep-curl-的输出">grep curl 的输出</h1>

<pre><code class="language-bash">curl -s  https://www.loldytt.com/Zuixingangju/AHJZBSRX/ 2&gt;&amp;1 | grep &quot;thunder:&quot; -a
</code></pre>

<h1 id="根据-pid-来查找它所占用的端口">根据 PID 来查找它所占用的端口</h1>

<pre><code class="language-bash">sudo lsof -Pan -p 5963 -i
</code></pre>

<p>将 p 后面的数值, 替换为你所要的 PID 进程ID即可.</p>

<h1 id="查找空文件并删除">查找空文件并删除</h1>

<pre><code class="language-bash">find  /tmp -type f -empty -user vivek -delete
</code></pre>

<h1 id="grep-正则匹配中括号的内容-非贪婪模式">grep 正则匹配中括号的内容(非贪婪模式)</h1>

<pre><code class="language-bash">head -n 100 analyze.json | grep -E '&quot;rule&quot;:\[[^]]*]'
</code></pre>

<pre><code class="language-bash">$ cat /tmp/test.grep.txt | grep -E '&quot;rule&quot;:\[[^]]*]'
hello lsjfl skdfj slkf lsaf sak &quot;rule&quot;:[&quot;151310&quot;]
lsdjlfjsf s &quot;rule&quot;:[&quot;150560&quot;,&quot;151223&quot;]


$ cat /tmp/test.grep.txt | grep -E '&quot;rule&quot;:\[[^]]*]' -o
&quot;rule&quot;:[&quot;151310&quot;]
&quot;rule&quot;:[&quot;150560&quot;,&quot;151223&quot;]
</code></pre>

<h1 id="统计各tcp连接状态的数量">统计各TCP连接状态的数量</h1>

<pre><code class="language-bash">netstat -n | awk '/^tcp/ {++S[$NF]} END {for (a in S) print a, S[a] }'
</code></pre>

<h1 id="统计进程打开的文件句柄数">统计进程打开的文件句柄数</h1>

<pre><code class="language-bash">lsof -n | awk '{print $2}' | sort | uniq -c | sort -nr
</code></pre>

<h1 id="tar-打包">tar 打包</h1>

<p>关于路径的问题, 一般打包时, tar 会按我们打包的路径进行打包的. 比如</p>

<pre><code class="language-bash">tar -cvzf hello.tar.gz /home/emacsist/hello-test

这样子, 打包里的路径是 home/emacsist/hello-test, 假设我们在 /tmp 目录里, 解压这个文件时, 最后的路径为 /tmp/home/emacsist/hello-test
</code></pre>

<p>如果想让打包的路径, 仅仅是 <code>hello-test</code> 目录, 则可以这样子</p>

<pre><code class="language-bash">tar -cvf gnupg2.tar.gz -C /home/emacsist hello-test

即 -C 参数来设置相对路径前缀, 后面的 hello-test 才是我们真正想打包的目录. 这样子, 打包里的路径, 就只是 hello-test 目录了.
</code></pre>

    </div>

    
    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">emacsist</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">2015-08-25</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>

    
    
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">Reward</label>
  <div class="qr-code">
    
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/img/wxpay.jpeg">
        <span>wechat</span>
      </label>
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/img/alipay.jpeg">
        <span>alipay</span>
      </label>
  </div>
</div>

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/linux/">linux</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/2015/08/25/tomcat%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%AF%BC%E5%85%A5%E6%BA%90%E7%A0%81%E5%B7%A5%E7%A8%8B%E5%88%B0eclipse/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Tomcat源码学习之导入源码工程到Eclipse</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/2015/08/24/mysql%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%8F%8A%E4%BD%BF%E7%94%A8%E5%8D%95%E6%9C%BA%E5%A4%9A%E5%AE%9E%E4%BE%8B%E7%AE%A1%E7%90%86/">
            <span class="next-text nav-default">MySQL源码编译及使用单机多实例管理</span>
            <span class="prev-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  <div id="comments-gitment"></div>
  <link rel="stylesheet" href="/lib/gitment/gitment-0.0.3.min.css">
    <script src="/lib/gitment/gitment-0.0.3.min.js"></script>
  <script type="text/javascript">
  const gitment = new Gitment({
    id: '2015-08-25 11:48:05 \x2b0000 UTC',
    title: 'Linux技巧收集',
    link: decodeURI(location.href),
    desc: '获取外网IP PUBLIC_IP=`wget http:\/\/ipecho.net\/plain -O - -q ; echo` echo $PUBLIC_IP 直接显示: wget http:\/\/ipecho.net\/plain -O - -q ; echo 查找历史命令 Ctrl\x2bR 搜索 从当前目录，递归搜索\x26rdquo;10.0.0.40\x26rdquo;这',
    owner: 'emacsist',
    repo: 'emacsist.github.io',
    oauth: {
      client_id: 'd1456501fba5329f3afa',
      client_secret: 'd1ecbb7929a49de947215701320c60b312a72d3a'
    }
  })
  gitment.render('comments-gitment')
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://github.com/imsun/gitment">comments powered by gitment.</a></noscript>

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:emacsist@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://twitter.com/emacsist2016" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://plus.google.com/u/0/114200054463267049438" class="iconfont icon-google" title="google"></a>
      <a href="https://github.com/emacsist" class="iconfont icon-github" title="github"></a>
      <a href="https://www.zhihu.com/people/emacist" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://www.douban.com/people/emacsist/" class="iconfont icon-douban" title="douban"></a>
  <a href="https://emacsist.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
    <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>


  <span class="copyright-year">
    &copy; 
    
      2014 - 
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">emacsist</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  
<script type="text/javascript" src="/dist/even.min.js?v=3.1.1"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-118327923-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>








<script src="https://s13.cnzz.com/z_stat.php?id=1273926342&web_id=1273926342"></script>

</body>
</html>
