<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Go学习 - emacsist</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="emacsist" />
  <meta name="description" content="安装多个版本的 go GVM Go依赖管理与 GOPATH 的关系. GOPATH环境变" />

  <meta name="keywords" content="Golang, Java, PostgreSQL, Postgres, MySQL, emacsist, RabbitMQ, Go, emacs, orgmode" />






<meta name="generator" content="Hugo 0.67.1" />


<link rel="canonical" href="https://emacsist.github.io/2016/10/18/go%E5%AD%A6%E4%B9%A0/" />

<link href="." rel="alternate" type="application/rss+xml" title="emacsist" />
<link href="." rel="feed" type="application/rss+xml" title="emacsist" />



<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<link href="/dist/even.min.css?v=3.1.1" rel="stylesheet">





<meta property="og:title" content="Go学习" />
<meta property="og:description" content="安装多个版本的 go GVM Go依赖管理与 GOPATH 的关系. GOPATH环境变" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://emacsist.github.io/2016/10/18/go%E5%AD%A6%E4%B9%A0/" />
<meta property="article:published_time" content="2016-10-18T19:35:00+00:00" />
<meta property="article:modified_time" content="2016-10-18T19:35:00+00:00" />
<meta itemprop="name" content="Go学习">
<meta itemprop="description" content="安装多个版本的 go GVM Go依赖管理与 GOPATH 的关系. GOPATH环境变">
<meta itemprop="datePublished" content="2016-10-18T19:35:00&#43;00:00" />
<meta itemprop="dateModified" content="2016-10-18T19:35:00&#43;00:00" />
<meta itemprop="wordCount" content="5968">



<meta itemprop="keywords" content="golang,go," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go学习"/>
<meta name="twitter:description" content="安装多个版本的 go GVM Go依赖管理与 GOPATH 的关系. GOPATH环境变"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">emacsist</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">emacsist</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Go学习</h1>

      <div class="post-meta">
        <span class="post-time"> 2016-10-18 </span>
        <div class="post-category">
            
              <a href="/categories/golang/"> golang </a>
            
              <a href="/categories/go/"> go </a>
            
          </div>
        <span class="more-meta"> 5968 words </span>
        <span class="more-meta"> 12 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#安装多个版本的-go">安装多个版本的 go</a></li>
    <li><a href="#go依赖管理与-gopath-的关系">Go依赖管理与 GOPATH 的关系.</a></li>
    <li><a href="#自己对go中包的理解">自己对Go中包的理解</a></li>
    <li><a href="#golang中的字符串拼接">Golang中的字符串拼接</a></li>
    <li><a href="#vscode中调试go">vscode中调试Go</a></li>
    <li><a href="#go单元测试">Go单元测试</a>
      <ul>
        <li><a href="#单元测试某个指定的方法">单元测试某个指定的方法</a></li>
        <li><a href="#单元测试递归执行">单元测试递归执行</a></li>
        <li><a href="#关于单元测试中的-log-logf">关于单元测试中的 Log()， Logf()</a></li>
      </ul>
    </li>
    <li><a href="#golang中类似java中的tostring功能">Golang中类似Java中的<code>toString()</code>功能</a></li>
    <li><a href="#int64-to-string">int64 to String</a></li>
    <li><a href="#通过反射遍历结构体">通过反射遍历结构体</a></li>
    <li><a href="#将json字段串自动转化生成struct结构">将json字段串自动转化生成struct结构</a>
      <ul>
        <li><a href="#json-字符串-转换为-struct">json 字符串 转换为 struct</a></li>
        <li><a href="#struct-对象-转换为json字符串">struct 对象 转换为json字符串</a></li>
        <li><a href="#示例">示例</a></li>
      </ul>
    </li>
    <li><a href="#参数中是否是指针的区别">参数中是否是指针的区别:</a></li>
    <li><a href="#常用go包">常用Go包</a></li>
    <li><a href="#常见错误">常见错误</a>
      <ul>
        <li><a href="#http-contentlengthxxx-with-body-length-yyy">http: ContentLength=xxx with Body length yyy</a></li>
        <li><a href="#cannot-define-new-methods-on-non-local-type">cannot define new methods on non-local type</a></li>
        <li><a href="#cant-load-package-import-cycle-not-allowed">can&rsquo;t load package: import cycle not allowed</a></li>
        <li><a href="#too-many-arguments-to-return">too many arguments to return</a></li>
        <li><a href="#interface-">*interface</a></li>
        <li><a href="#cannot-use-nil-as-type-xxx">cannot use nil as type xxx</a></li>
        <li><a href="#found-packages-xxxx--and-xxxx-xxxx-in-xxxx">found packages xxxx () and xxxx (xxxx) in xxxx</a></li>
      </ul>
    </li>
    <li><a href="#struct-结构体的继承">struct 结构体的继承</a></li>
    <li><a href="#go中的字符串转换为字符数组">Go中的字符串转换为字符数组</a></li>
    <li><a href="#golang中顶级的json数组字符串转换为json对象">Golang中顶级的JSON数组字符串转换为json对象</a></li>
    <li><a href="#创建一个自定义的error">创建一个自定义的error</a></li>
    <li><a href="#json数组转换为map">json数组转换为map</a></li>
    <li><a href="#go交叉编译">Go交叉编译</a>
      <ul>
        <li><a href="#常见错误-1">常见错误:</a></li>
        <li><a href="#linux下交叉编译mac">Linux下交叉编译Mac</a></li>
        <li><a href="#os常量以及arch常量">OS常量以及ARCH常量</a></li>
      </ul>
    </li>
    <li><a href="#go打包静态资源">Go打包静态资源</a>
      <ul>
        <li><a href="#常用编译选项">常用编译选项</a></li>
      </ul>
    </li>
    <li><a href="#数组与slice-区别">数组与slice 区别</a></li>
    <li><a href="#go中使用-redis">Go中使用 redis</a></li>
    <li><a href="#go-中使用-gorm-与-mysql-交互">Go 中使用 gorm 与 mysql 交互</a></li>
    <li><a href="#go-中使用-rabbitmq">go 中使用 rabbitmq</a>
      <ul>
        <li><a href="#注意事项">注意事项</a></li>
      </ul>
    </li>
    <li><a href="#go中long与timestamp-json的转换">go中long与timestamp json的转换</a></li>
    <li><a href="#go-中找出实现了某接口的代码">Go 中找出实现了某接口的代码</a></li>
    <li><a href="#golang中实现优雅关闭程序">Golang中实现优雅关闭程序</a>
      <ul>
        <li><a href="#检查程序监控了哪些信号">检查程序监控了哪些信号</a></li>
      </ul>
    </li>
    <li><a href="#golang中的struct-tag使用">Golang中的struct tag使用</a></li>
    <li><a href="#限制goalng的http-工作线程goroutine">限制Goalng的HTTP 工作线程(goroutine)</a></li>
    <li><a href="#为什么我的内存没有被操作系统回收">为什么我的内存没有被操作系统回收？</a></li>
    <li><a href="#golang18-中的优雅关闭-http">Golang1.8 中的优雅关闭 http</a></li>
    <li><a href="#按-github-风格的项目组织结构">按 github 风格的项目组织结构</a></li>
    <li><a href="#压缩编译后的文件大小">压缩编译后的文件大小</a>
      <ul>
        <li><a href="#去掉符号信息">去掉符号信息</a></li>
        <li><a href="#使用-upx-压缩">使用 upx 压缩</a></li>
      </ul>
    </li>
    <li><a href="#golang-中的-web">Golang 中的 web</a></li>
    <li><a href="#短声明注意">短声明注意</a></li>
    <li><a href="#类型转换">类型转换</a></li>
    <li><a href="#golang-中格式化日期">Golang 中格式化日期</a></li>
    <li><a href="#go-中发送登录请求保持-cookie">Go 中发送登录请求（保持 cookie)</a></li>
    <li><a href="#go-中提交表单">Go 中提交表单</a></li>
    <li><a href="#logrus-设置日志时间格式">logrus 设置日志时间格式</a></li>
    <li><a href="#go-中自动重连-rabbitmq">Go 中自动重连 RabbitMQ</a></li>
    <li><a href="#go-中批量处理-sql">Go 中批量处理 SQL</a></li>
    <li><a href="#go-中处理-gbk-字符集">Go 中处理 GBK 字符集</a></li>
    <li><a href="#go-中-get-请求的参数处理">Go 中 GET 请求的参数处理</a></li>
    <li><a href="#go-中调试-http-的-request-和-response">Go 中调试 http 的 request 和 response</a></li>
    <li><a href="#go-中按行读取-string">Go 中按行读取 string</a></li>
    <li><a href="#go-中按空格-split-字符串">Go 中按空格 split 字符串</a></li>
    <li><a href="#读取-json-文件为-struct-结构体">读取 json 文件为 struct 结构体</a></li>
    <li><a href="#string-与-int-互转">string 与 int 互转</a></li>
    <li><a href="#go-中-http-client-的-timeout-设置">Go 中 http client 的 timeout 设置</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h2 id="安装多个版本的-go">安装多个版本的 go</h2>
<p><a href="https://github.com/moovweb/gvm">GVM</a></p>
<h2 id="go依赖管理与-gopath-的关系">Go依赖管理与 GOPATH 的关系.</h2>
<p><code>GOPATH</code>环境变量中可以包含多个目录。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">go get
</code></pre></div><p>这种方式，它会将依赖下载在<code>$GOPATH</code>环境变量中的第一个目录中.</p>
<h2 id="自己对go中包的理解">自己对Go中包的理解</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">编写代码时，使用的<span style="color:#e6db74">`</span>package<span style="color:#e6db74">`</span>，表示代码所在的包名。

引用时，<span style="color:#e6db74">`</span>import package<span style="color:#e6db74">`</span>，这个<span style="color:#e6db74">`</span>package<span style="color:#e6db74">`</span>表示相对于<span style="color:#e6db74">`</span>GOPATH<span style="color:#e6db74">`</span>中的<span style="color:#e6db74">`</span>src<span style="color:#e6db74">`</span>目录下的目录名，多层目录，使用<span style="color:#e6db74">`</span>/<span style="color:#e6db74">`</span>分隔。
一般来说，引用的<span style="color:#e6db74">`</span>package<span style="color:#e6db74">`</span>的名字，和你的最后一个目录的名字相同，但也可以不同。<span style="color:#e6db74">`</span>import package<span style="color:#e6db74">`</span>的名字，以所在包名的名字为准，而不是以目录名为准.
</code></pre></div><h2 id="golang中的字符串拼接">Golang中的字符串拼接</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package main

import <span style="color:#f92672">(</span>
    <span style="color:#e6db74">&#34;bytes&#34;</span>
    <span style="color:#e6db74">&#34;fmt&#34;</span>
<span style="color:#f92672">)</span>

func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    var buffer bytes.Buffer

    <span style="color:#66d9ef">for</span> i :<span style="color:#f92672">=</span> 0; i &lt; 1000; i++ <span style="color:#f92672">{</span>
        buffer.WriteString<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>

    fmt.Println<span style="color:#f92672">(</span>buffer.String<span style="color:#f92672">())</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="vscode中调试go">vscode中调试Go</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">can<span style="color:#960050;background-color:#1e0010">&#39;</span>t load package: package .: no buildable Go source files in /ihome/go/golang-weibo-sdk
exit status <span style="color:#ae81ff">1</span>
</code></pre></div><p>这个问题是由于你没有将设置指向main.go的所在目录里.即，在Go的debug设置里，要类似如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;0.2.0&#34;</span>,
    <span style="color:#e6db74">&#34;configurations&#34;</span>: <span style="color:#f92672">[{</span>
        <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Launch&#34;</span>,
        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;go&#34;</span>,
        <span style="color:#e6db74">&#34;request&#34;</span>: <span style="color:#e6db74">&#34;launch&#34;</span>,
        <span style="color:#e6db74">&#34;mode&#34;</span>: <span style="color:#e6db74">&#34;debug&#34;</span>,
        <span style="color:#e6db74">&#34;remotePath&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
        <span style="color:#e6db74">&#34;port&#34;</span>: 2345,
        <span style="color:#e6db74">&#34;host&#34;</span>: <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
        <span style="color:#e6db74">&#34;program&#34;</span>: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>workspaceRoot<span style="color:#e6db74">}</span><span style="color:#e6db74">/src/main&#34;</span>,
        <span style="color:#e6db74">&#34;env&#34;</span>: <span style="color:#f92672">{}</span>,
        <span style="color:#e6db74">&#34;args&#34;</span>: <span style="color:#f92672">[]</span>,
        <span style="color:#e6db74">&#34;showLog&#34;</span>: true
    <span style="color:#f92672">}]</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>即，<code>program</code>要设置为指向Go的main函数文件所在的目录即可.</p>
<h2 id="go单元测试">Go单元测试</h2>
<p>必须要将命令行，先切换到要进行单元测试文件的目录的根目录。比如：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$GOPATH/src/utils/myutil.go
$GOPATH/src/utils/myutil_test.go
</code></pre></div><p>要想进行 <code>myutil_test.go</code> 的单元测试，则先切换到目录<code>$GOPATH/src/utils</code>，然后在该目录下执行命令:<code>go test</code>即可。</p>
<h3 id="单元测试某个指定的方法">单元测试某个指定的方法</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">go test -run mehtodName
</code></pre></div><h3 id="单元测试递归执行">单元测试递归执行</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">进入到$GOPATH的根目录，然后按以下方式执行即可:
go test com.github.emacsist.weibosdk/api...
</code></pre></div><h3 id="关于单元测试中的-log-logf">关于单元测试中的 Log()， Logf()</h3>
<p>默认的情况下，<code>go test</code>并不会输出这些， 如果需要的话，可以添加<code>go test -v </code>来输出详细信息.</p>
<h2 id="golang中类似java中的tostring功能">Golang中类似Java中的<code>toString()</code>功能</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package resp

import <span style="color:#f92672">(</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
<span style="color:#f92672">)</span>

// ErrorResp ： 错误码返回对象
type ErrorResp struct <span style="color:#f92672">{</span>
	Request   string <span style="color:#e6db74">`</span>json:<span style="color:#e6db74">&#34;request&#34;</span><span style="color:#e6db74">`</span>
	ErrorCode int32  <span style="color:#e6db74">`</span>json:<span style="color:#e6db74">&#34;error_code&#34;</span><span style="color:#e6db74">`</span>
	Error     string <span style="color:#e6db74">`</span>json:<span style="color:#e6db74">&#34;error&#34;</span><span style="color:#e6db74">`</span>
<span style="color:#f92672">}</span>

func <span style="color:#f92672">(</span>errorResp *ErrorResp<span style="color:#f92672">)</span> String<span style="color:#f92672">()</span> string <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">return</span> fmt.Sprintf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request=%v\nErrorCode=%v\nError=%v\n&#34;</span>, errorResp.Request, errorResp.ErrorCode, errorResp.Error<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>即为它添加一个方法 <code>String() string</code>即可，这样子，在调用<code>fmt.Printf()</code>这些格式化打印时，就会自动调用对象的<code>String()</code>方法来打印了.</p>
<h2 id="int64-to-string">int64 to String</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
import <span style="color:#e6db74">&#34;strconv&#34;</span>

strconv.FormatInt<span style="color:#f92672">(</span>int64Value, 10<span style="color:#f92672">)</span>
</code></pre></div><h2 id="通过反射遍历结构体">通过反射遍历结构体</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package main

import <span style="color:#f92672">(</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;reflect&#34;</span>
<span style="color:#f92672">)</span>

type Person struct <span style="color:#f92672">{</span>
	Age  int
	Name string
<span style="color:#f92672">}</span>

func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	p :<span style="color:#f92672">=</span> Person<span style="color:#f92672">{</span>Age: 10, Name: <span style="color:#e6db74">&#34;HelloWorld&#34;</span><span style="color:#f92672">}</span>

	refValue :<span style="color:#f92672">=</span> reflect.ValueOf<span style="color:#f92672">(</span>&amp;p<span style="color:#f92672">)</span>

	fields :<span style="color:#f92672">=</span> refValue.Elem<span style="color:#f92672">()</span>
	<span style="color:#66d9ef">for</span> i :<span style="color:#f92672">=</span> 0; i &lt; fields.NumField<span style="color:#f92672">()</span>; i++ <span style="color:#f92672">{</span>
		field :<span style="color:#f92672">=</span> fields.Field<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span>
		fieldName :<span style="color:#f92672">=</span> fields.Type<span style="color:#f92672">()</span>.Field<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span>.Name
		fieldValue :<span style="color:#f92672">=</span> field.Interface<span style="color:#f92672">()</span>
		fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;fieldName = %v, fieldValue = %v\n&#34;</span>, fieldName, fieldValue<span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>要注意的是，<code>fieldName</code>是通过<code>fields</code>这个来获取的.</p>
<p>如果想要将字段的值转换为确定类型的值，则就可以这样子做:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package main

import <span style="color:#f92672">(</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;reflect&#34;</span>
<span style="color:#f92672">)</span>

type Person struct <span style="color:#f92672">{</span>
	Age  int
	Name string
<span style="color:#f92672">}</span>

func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	p :<span style="color:#f92672">=</span> Person<span style="color:#f92672">{</span>Age: 10, Name: <span style="color:#e6db74">&#34;HelloWorld&#34;</span><span style="color:#f92672">}</span>

	refValue :<span style="color:#f92672">=</span> reflect.ValueOf<span style="color:#f92672">(</span>&amp;p<span style="color:#f92672">)</span>

	fields :<span style="color:#f92672">=</span> refValue.Elem<span style="color:#f92672">()</span>
	<span style="color:#66d9ef">for</span> i :<span style="color:#f92672">=</span> 0; i &lt; fields.NumField<span style="color:#f92672">()</span>; i++ <span style="color:#f92672">{</span>
		field :<span style="color:#f92672">=</span> fields.Field<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span>
		fieldName :<span style="color:#f92672">=</span> fields.Type<span style="color:#f92672">()</span>.Field<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span>.Name

		<span style="color:#66d9ef">if</span> field.Type<span style="color:#f92672">()</span>.Name<span style="color:#f92672">()</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;string&#34;</span> <span style="color:#f92672">{</span>
			fieldValue :<span style="color:#f92672">=</span> field.Interface<span style="color:#f92672">()</span>.<span style="color:#f92672">(</span>string<span style="color:#f92672">)</span>
			fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;string --&gt; fieldName = %v, fieldValue = %v\n&#34;</span>, fieldName, fieldValue<span style="color:#f92672">)</span>
		<span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> field.Type<span style="color:#f92672">()</span>.Name<span style="color:#f92672">()</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;int&#34;</span> <span style="color:#f92672">{</span>
			fieldValue :<span style="color:#f92672">=</span> field.Interface<span style="color:#f92672">()</span>.<span style="color:#f92672">(</span>int<span style="color:#f92672">)</span>
			fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;int --&gt; fieldName = %v, fieldValue = %v\n&#34;</span>, fieldName, fieldValue<span style="color:#f92672">)</span>
		<span style="color:#f92672">}</span>

	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><h2 id="将json字段串自动转化生成struct结构">将json字段串自动转化生成struct结构</h2>
<p><a href="http://json2struct.mervine.net/">mervine.net</a>
<a href="https://mholt.github.io/json-to-go/">mholt.github.io</a></p>
<h3 id="json-字符串-转换为-struct">json 字符串 转换为 struct</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">import <span style="color:#e6db74">&#34;encoding/json&#34;</span>

json.Unmarshal<span style="color:#f92672">([]</span>byte<span style="color:#f92672">(</span>body<span style="color:#f92672">)</span>, &amp;status<span style="color:#f92672">)</span>
</code></pre></div><h3 id="struct-对象-转换为json字符串">struct 对象 转换为json字符串</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">p为结构体变量
body, error :<span style="color:#f92672">=</span> json.Marshal<span style="color:#f92672">(</span>p<span style="color:#f92672">)</span>
</code></pre></div><h3 id="示例">示例</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package main

import <span style="color:#f92672">(</span>
	<span style="color:#e6db74">&#34;encoding/json&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
<span style="color:#f92672">)</span>

// Person : test object
type Person struct <span style="color:#f92672">{</span>
	Name string
	Age  int
<span style="color:#f92672">}</span>

func changeValue<span style="color:#f92672">(</span>p Person<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
	p.Age <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
<span style="color:#f92672">}</span>

func changeValue2<span style="color:#f92672">(</span>p *Person<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
	p.Age <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
<span style="color:#f92672">}</span>

func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	p :<span style="color:#f92672">=</span> Person<span style="color:#f92672">{</span>Age: 1, Name: <span style="color:#e6db74">&#34;HelloWorld&#34;</span><span style="color:#f92672">}</span>
	changeValue<span style="color:#f92672">(</span>p<span style="color:#f92672">)</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;changeValue, name -&gt;%v, age -&gt; %v\n&#34;</span>, p.Name, p.Age<span style="color:#f92672">)</span>
	changeValue2<span style="color:#f92672">(</span>&amp;p<span style="color:#f92672">)</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;changeValue2, name -&gt;%v, age -&gt; %v\n&#34;</span>, p.Name, p.Age<span style="color:#f92672">)</span>

	body, _ :<span style="color:#f92672">=</span> json.Marshal<span style="color:#f92672">(</span>p<span style="color:#f92672">)</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;struct to json -&gt; %v\n&#34;</span>, string<span style="color:#f92672">(</span>body<span style="color:#f92672">))</span>

	newP :<span style="color:#f92672">=</span> Person<span style="color:#f92672">{}</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;newP age -&gt; %v\n&#34;</span>, newP.Age<span style="color:#f92672">)</span>
	json.Unmarshal<span style="color:#f92672">(</span>body, &amp;newP<span style="color:#f92672">)</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;after json to struct -&gt; %v\n&#34;</span>, newP.Age<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>输出的结果为</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>Running<span style="color:#f92672">]</span> go run <span style="color:#e6db74">&#34;/ihome/go/golang-weibo-sdk/src/main/main.go&#34;</span>
changeValue, name -&gt;HelloWorld, age -&gt; <span style="color:#ae81ff">1</span>
changeValue2, name -&gt;HelloWorld, age -&gt; <span style="color:#ae81ff">10</span>
struct to json -&gt; <span style="color:#f92672">{</span><span style="color:#e6db74">&#34;Name&#34;</span>:<span style="color:#e6db74">&#34;HelloWorld&#34;</span>,<span style="color:#e6db74">&#34;Age&#34;</span>:10<span style="color:#f92672">}</span>
newP age -&gt; <span style="color:#ae81ff">0</span>
after json to struct -&gt; <span style="color:#ae81ff">10</span>

<span style="color:#f92672">[</span>Done<span style="color:#f92672">]</span> exited with code<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> in 0.13 seconds
</code></pre></div><h2 id="参数中是否是指针的区别">参数中是否是指针的区别:</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package main

import <span style="color:#e6db74">&#34;fmt&#34;</span>

// Person : test object
type Person struct <span style="color:#f92672">{</span>
	Name string
	Age  int
<span style="color:#f92672">}</span>

func changeValue<span style="color:#f92672">(</span>p Person<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
	p.Age <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
<span style="color:#f92672">}</span>

func changeValue2<span style="color:#f92672">(</span>p *Person<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
	p.Age <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
<span style="color:#f92672">}</span>

func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	p :<span style="color:#f92672">=</span> Person<span style="color:#f92672">{</span>Age: 1, Name: <span style="color:#e6db74">&#34;HelloWorld&#34;</span><span style="color:#f92672">}</span>
	changeValue<span style="color:#f92672">(</span>p<span style="color:#f92672">)</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;changeValue, name -&gt;%v, age -&gt; %v\n&#34;</span>, p.Name, p.Age<span style="color:#f92672">)</span>
	changeValue2<span style="color:#f92672">(</span>&amp;p<span style="color:#f92672">)</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;changeValue2, name -&gt;%v, age -&gt; %v\n&#34;</span>, p.Name, p.Age<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>输出的结果为</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>Running<span style="color:#f92672">]</span> go run <span style="color:#e6db74">&#34;/ihome/go/golang-weibo-sdk/src/main/main.go&#34;</span>
changeValue, name -&gt;HelloWorld, age -&gt; <span style="color:#ae81ff">1</span>
changeValue2, name -&gt;HelloWorld, age -&gt; <span style="color:#ae81ff">10</span>

<span style="color:#f92672">[</span>Done<span style="color:#f92672">]</span> exited with code<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> in 0.103 seconds
</code></pre></div><h2 id="常用go包">常用Go包</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">将struct转换为查询参数:
https://godoc.org/github.com/google/go-querystring/query
</code></pre></div><h2 id="常见错误">常见错误</h2>
<h3 id="http-contentlengthxxx-with-body-length-yyy">http: ContentLength=xxx with Body length yyy</h3>
<p>ContentLength=299 with Body length 367</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">这一般是request对象前后的长度不一致（中间关闭了或处理了，导致后面的再次读取时不一致）
</code></pre></div><p>参考: <a href="http://stackoverflow.com/questions/31337891/net-http-http-contentlength-222-with-body-length-0">stackoverflow</a></p>
<p>具体例子：我是在构造<code>request</code>时这样子写:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">	bodyBuf :<span style="color:#f92672">=</span> &amp;bytes.Buffer<span style="color:#f92672">{}</span>
	bodyWriter :<span style="color:#f92672">=</span> multipart.NewWriter<span style="color:#f92672">(</span>bodyBuf<span style="color:#f92672">)</span>

	v :<span style="color:#f92672">=</span> reflect.ValueOf<span style="color:#f92672">(</span>param<span style="color:#f92672">)</span>
	fileds :<span style="color:#f92672">=</span> v.Elem<span style="color:#f92672">()</span>

	paramsMap :<span style="color:#f92672">=</span> netURL.Values<span style="color:#f92672">{}</span>
	//defer bodyWriter.Close<span style="color:#f92672">()</span>

	<span style="color:#66d9ef">return</span> http.NewRequest<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;POST&#34;</span>, URL, bodyBuf<span style="color:#f92672">)</span>
</code></pre></div><p>关键是那行：<code>defer bodyWriter.Close()</code>，注释掉这行就可以了.</p>
<h3 id="cannot-define-new-methods-on-non-local-type">cannot define new methods on non-local type</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">type MyRouter mux.Router

func <span style="color:#f92672">(</span>m *MyRouter<span style="color:#f92672">)</span> F<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> ... <span style="color:#f92672">}</span>

或者

type MyRouter struct <span style="color:#f92672">{</span>
    *mux.Router
<span style="color:#f92672">}</span>

func <span style="color:#f92672">(</span>m *MyRouter<span style="color:#f92672">)</span> F<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> ... <span style="color:#f92672">}</span>

...
r :<span style="color:#f92672">=</span> &amp;MyRouter<span style="color:#f92672">{</span>router<span style="color:#f92672">}</span>
r.F<span style="color:#f92672">()</span>
</code></pre></div><h3 id="cant-load-package-import-cycle-not-allowed">can&rsquo;t load package: import cycle not allowed</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package project/controllers/account
    imports project/controllers/base
    imports project/components/mux
    imports project/controllers/account
</code></pre></div><p>这表明有循环引用，循环引用的结果为:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">                  project/controllers/account
                     ^                    <span style="color:#ae81ff">\ </span>   
                    /                      <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                   /                        <span style="color:#ae81ff">\ </span>
                  /                         <span style="color:#ae81ff">\/</span>
         project/components/mux &lt;--- project/controllers/base
</code></pre></div><p>只要处理掉这个循环引用的一条链即可解决.</p>
<h3 id="too-many-arguments-to-return">too many arguments to return</h3>
<p>一般来说，是你的方法签名中没有返回值，但你却进行了<code>return value</code>或者，你的方法签名中的返回值个数与<code>return 语句不匹配</code></p>
<h3 id="interface-">*interface</h3>
<p>这个应该是你想在方法里进行泛型例如写成这样子:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package helper

import <span style="color:#e6db74">&#34;reflect&#34;</span>

// SetDefaultValues : 设置参数默认值
func SetDefaultValues<span style="color:#f92672">(</span>param *interface<span style="color:#f92672">{})</span> <span style="color:#f92672">{</span>
	v :<span style="color:#f92672">=</span> reflect.ValueOf<span style="color:#f92672">(</span>param<span style="color:#f92672">)</span>
	fileds :<span style="color:#f92672">=</span> v.Elem<span style="color:#f92672">()</span>
	<span style="color:#66d9ef">for</span> i :<span style="color:#f92672">=</span> 0; i &lt; fileds.NumField<span style="color:#f92672">()</span>; i++ <span style="color:#f92672">{</span>
		field :<span style="color:#f92672">=</span> fileds.Field<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span>
		// Ignore fields that don<span style="color:#960050;background-color:#1e0010">&#39;</span>t have the same type as a string
		<span style="color:#66d9ef">if</span> field.Type<span style="color:#f92672">()</span>.Name<span style="color:#f92672">()</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;string&#34;</span> <span style="color:#f92672">{</span>
			//如果是一个字符串对象
			<span style="color:#66d9ef">if</span> field.CanSet<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
				field.SetString<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span>
			<span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> field.Type<span style="color:#f92672">()</span>.Name<span style="color:#f92672">()</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;int&#34;</span> <span style="color:#f92672">||</span> field.Type<span style="color:#f92672">()</span>.Name<span style="color:#f92672">()</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;int64&#34;</span> <span style="color:#f92672">{</span>
			//如果是整型
			<span style="color:#66d9ef">if</span> field.CanSet<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
				field.SetInt<span style="color:#f92672">(</span>-1<span style="color:#f92672">)</span>
			<span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>但其实<code>interface{}</code>它表示的是接收任意的类型（包括指针），所以，这里不能这样子，应该修改参数为:<code>param interface{}</code>即可。</p>
<p>这样子，在调用方法时，传递的是指针，那么它就代表指针，传递的是普通类型，那就是普通类型。</p>
<h3 id="cannot-use-nil-as-type-xxx">cannot use nil as type xxx</h3>
<p>这表你的xxx并不能接受<code>nil</code>值。（一般来说，只有指针类型才能接受nil值)</p>
<h3 id="found-packages-xxxx--and-xxxx-xxxx-in-xxxx">found packages xxxx () and xxxx (xxxx) in xxxx</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">┌─<span style="color:#f92672">[</span>sky@sky-linux<span style="color:#f92672">]</span> - <span style="color:#f92672">[</span>/ihome/go/golang-weibo-sdk/src/com.github.emacsist.weibosdk/api/business/status<span style="color:#f92672">]</span> - <span style="color:#f92672">[</span>2016-10-21 05:40:43<span style="color:#f92672">]</span>                              
└─<span style="color:#f92672">[</span>2<span style="color:#f92672">]</span> &lt;git:<span style="color:#f92672">(</span>master 3c154e3✱✈<span style="color:#f92672">)</span> &gt; go test -run StatusesRepostTimelineBizString                                                                               
../../../helper/HttpHelper.go:8:2: found packages resp <span style="color:#f92672">(</span>CommentsAndTotalNumberResp.go<span style="color:#f92672">)</span> and api <span style="color:#f92672">(</span>TagsTagsBatchOther.go<span style="color:#f92672">)</span> in /ihome/go/golang-weibo-sdk/src/co
m.github.emacsist.weibosdk/resp 
</code></pre></div><p>Go语言规则，所有在同一个目录的源文件，都必须是同属一个包的.解决了这个问题就可以编译通过了.</p>
<h2 id="struct-结构体的继承">struct 结构体的继承</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">// Person : test object
type Person struct <span style="color:#f92672">{</span>
	Name string
	Age  int
	Animal
<span style="color:#f92672">}</span>

type Animal struct <span style="color:#f92672">{</span>
    Colour string
    Name string
<span style="color:#f92672">}</span>

</code></pre></div><h2 id="go中的字符串转换为字符数组">Go中的字符串转换为字符数组</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package main

import <span style="color:#e6db74">&#34;fmt&#34;</span>

func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    fmt.Println<span style="color:#f92672">(</span>string<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello&#34;</span><span style="color:#f92672">[</span>1<span style="color:#f92672">]))</span>              // ASCII only
    fmt.Println<span style="color:#f92672">(</span>string<span style="color:#f92672">([]</span>rune<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello, 世界&#34;</span><span style="color:#f92672">)[</span>1<span style="color:#f92672">]))</span> // UTF-8
    fmt.Println<span style="color:#f92672">(</span>string<span style="color:#f92672">([]</span>rune<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello, 世界&#34;</span><span style="color:#f92672">)[</span>8<span style="color:#f92672">]))</span> // UTF-8
<span style="color:#f92672">}</span>
</code></pre></div><p>千万要注意：<code>string[0:1]</code>这种形式是按<code>字节</code>来分隔的.<code>len(string)</code>返回的是字节数.
要操作字符的话，则要使用<code>rune</code>类型。</p>
<h2 id="golang中顶级的json数组字符串转换为json对象">Golang中顶级的JSON数组字符串转换为json对象</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package main

import <span style="color:#e6db74">&#34;fmt&#34;</span>
import <span style="color:#e6db74">&#34;encoding/json&#34;</span>

type PublicKey struct <span style="color:#f92672">{</span>
	Id  int
	Key string
<span style="color:#f92672">}</span>

func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	keysBody :<span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>byte<span style="color:#f92672">(</span><span style="color:#e6db74">`</span><span style="color:#f92672">[{</span><span style="color:#e6db74">&#34;id&#34;</span>: 1,<span style="color:#e6db74">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;-&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>: 2,<span style="color:#e6db74">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;-&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>: 3,<span style="color:#e6db74">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;-&#34;</span><span style="color:#f92672">}]</span><span style="color:#e6db74">`</span><span style="color:#f92672">)</span>
	keys :<span style="color:#f92672">=</span> make<span style="color:#f92672">([]</span>PublicKey, 0<span style="color:#f92672">)</span>
	json.Unmarshal<span style="color:#f92672">(</span>keysBody, &amp;keys<span style="color:#f92672">)</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%#v&#34;</span>, keys<span style="color:#f92672">[</span>2<span style="color:#f92672">]</span>.Id<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

</code></pre></div><h2 id="创建一个自定义的error">创建一个自定义的error</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">import <span style="color:#e6db74">&#34;errors&#34;</span>

errors.New<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;xx&#34;</span><span style="color:#f92672">)</span>
</code></pre></div><h2 id="json数组转换为map">json数组转换为map</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package main

import <span style="color:#f92672">(</span>
	<span style="color:#e6db74">&#34;encoding/json&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
<span style="color:#f92672">)</span>

func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	h :<span style="color:#f92672">=</span> <span style="color:#e6db74">`</span><span style="color:#f92672">[</span>
    <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;221012100001985342&#34;</span>: <span style="color:#e6db74">&#34;80后&#34;</span>,
        <span style="color:#e6db74">&#34;weight&#34;</span>: <span style="color:#ae81ff">50</span>
    <span style="color:#f92672">}</span>,
     <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;221012100001985342&#34;</span>: <span style="color:#e6db74">&#34;80后1&#34;</span>,
        <span style="color:#e6db74">&#34;weight&#34;</span>: <span style="color:#ae81ff">51</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">]</span><span style="color:#e6db74">`</span>
	var hell <span style="color:#f92672">[]</span>map<span style="color:#f92672">[</span>string<span style="color:#f92672">]</span>interface<span style="color:#f92672">{}</span>

	err :<span style="color:#f92672">=</span> json.Unmarshal<span style="color:#f92672">([]</span>byte<span style="color:#f92672">(</span>h<span style="color:#f92672">)</span>, &amp;hell<span style="color:#f92672">)</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%v\n&#34;</span>, err<span style="color:#f92672">)</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%v\n&#34;</span>, h<span style="color:#f92672">)</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%v\n&#34;</span>, hell<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

</code></pre></div><h2 id="go交叉编译">Go交叉编译</h2>
<p>进入Go的安装目录<code>cd $GOROOT/src</code>，然后 选择要生成的目标构架的工具链:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># windows64位</span>
CGO_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> GOOS<span style="color:#f92672">=</span>windows GOARCH<span style="color:#f92672">=</span>amd64 ./make.bash

<span style="color:#75715e"># mac</span>
CGO_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> GOOS<span style="color:#f92672">=</span>darwin GOARCH<span style="color:#f92672">=</span>amd64 ./make.bash

<span style="color:#75715e"># linux 64</span>
CGO_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> GOOS<span style="color:#f92672">=</span>linux GOARCH<span style="color:#f92672">=</span>amd64 ./make.bash
</code></pre></div><h3 id="常见错误-1">常见错误:</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">┌─<span style="color:#f92672">[</span>sky@sky-linux<span style="color:#f92672">]</span> - <span style="color:#f92672">[</span>/ihome/go/go-current/src<span style="color:#f92672">]</span> - <span style="color:#f92672">[</span>2016-10-26 02:14:42<span style="color:#f92672">]</span>
└─<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span> &lt;&gt; CGO_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> GOOS<span style="color:#f92672">=</span>windows GOARCH<span style="color:#f92672">=</span>amd64 ./make.bash
<span style="color:#75715e">##### Building Go bootstrap tool.</span>
cmd/dist
ERROR: Cannot find /home/sky/go1.4/bin/go.
Set $GOROOT_BOOTSTRAP to a working Go tree &gt;<span style="color:#f92672">=</span> Go 1.4.
</code></pre></div><p>这表需要有一个<code>&gt;=1.4</code>的另一个<code>go</code>安装目录，并将<code>GOROOT_BOOTSTRAP</code>指向该目录即可.</p>
<h3 id="linux下交叉编译mac">Linux下交叉编译Mac</h3>
<p><a href="http://stackoverflow.com/questions/34084597/cross-compilation-of-cgo-for-darwin-fails">stackoverflow</a></p>
<h3 id="os常量以及arch常量">OS常量以及ARCH常量</h3>
<p><a href="https://github.com/golang/go/blob/master/src/go/build/syslist.go">syslist</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
package build

const goosList <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;android darwin dragonfly freebsd linux nacl netbsd openbsd plan9 solaris windows zos &#34;</span>
const goarchList <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;386 amd64 amd64p32 arm armbe arm64 arm64be ppc64 ppc64le mips mipsle mips64 mips64le mips64p32 mips64p32le ppc s390 s390x sparc sparc64 &#34;</span>

</code></pre></div><h2 id="go打包静态资源">Go打包静态资源</h2>
<p>安装: <code>go get -u github.com/jteeuwen/go-bindata/...</code></p>
<p><a href="https://github.com/jteeuwen/go-bindata">go-bindata</a></p>
<p>假设<code>/tmp/go</code>是一个<code>$GOPATH</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">┌─<span style="color:#f92672">[</span>sky@sky-linux<span style="color:#f92672">]</span> - <span style="color:#f92672">[</span>/tmp/go<span style="color:#f92672">]</span> - <span style="color:#f92672">[</span>2016-10-26 03:25:55<span style="color:#f92672">]</span>
└─<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span> &lt;&gt; ll /tmp/go/src/nlp/dict
total 820K
-rw-r--r-- <span style="color:#ae81ff">1</span> sky sky 3.1K 10月 <span style="color:#ae81ff">25</span> 18:36 adv_full.txt
-rw-r--r-- <span style="color:#ae81ff">1</span> sky sky 3.2K 10月 <span style="color:#ae81ff">25</span> 18:36 adv.txt
-rw-r--r-- <span style="color:#ae81ff">1</span> sky sky 212K 10月 <span style="color:#ae81ff">25</span> 18:36 neg_full.txt
-rw-r--r-- <span style="color:#ae81ff">1</span> sky sky 305K 10月 <span style="color:#ae81ff">25</span> 18:36 neg.txt
-rw-r--r-- <span style="color:#ae81ff">1</span> sky sky  <span style="color:#ae81ff">273</span> 10月 <span style="color:#ae81ff">25</span> 18:36 not_full.txt
-rw-r--r-- <span style="color:#ae81ff">1</span> sky sky  <span style="color:#ae81ff">287</span> 10月 <span style="color:#ae81ff">25</span> 18:36 not.txt
-rw-r--r-- <span style="color:#ae81ff">1</span> sky sky 116K 10月 <span style="color:#ae81ff">25</span> 18:36 pos_full.txt
-rw-r--r-- <span style="color:#ae81ff">1</span> sky sky 149K 10月 <span style="color:#ae81ff">25</span> 18:36 pos.txt
-rw-r--r-- <span style="color:#ae81ff">1</span> sky sky 8.0K 10月 <span style="color:#ae81ff">25</span> 21:21 stp_full.txt
-rw-r--r-- <span style="color:#ae81ff">1</span> sky sky 8.0K 10月 <span style="color:#ae81ff">25</span> 18:36 stp.txt

┌─<span style="color:#f92672">[</span>sky@sky-linux<span style="color:#f92672">]</span> - <span style="color:#f92672">[</span>/tmp/go<span style="color:#f92672">]</span> - <span style="color:#f92672">[</span>2016-10-26 12:35:32<span style="color:#f92672">]</span>                                                                                                                      
└─<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span> &lt;&gt; ./bin/go-bindata -o<span style="color:#f92672">=</span>src/nlp/asset/asset.go -pkg<span style="color:#f92672">=</span>asset -prefix <span style="color:#e6db74">&#34;/tmp/go/src/nlp/&#34;</span> /tmp/go/src/nlp/dict
</code></pre></div><p>说明：</p>
<p><code>-o</code> : 表示生成静态资源的访问包的文件.
<code>-pkg</code> ： 表示包名
<code>-prefix</code> ： 表示自动添加的前缀。</p>
<p><code>/tmp/go/src/nlp/dict</code>表示静态资源的目录.如果要递归的话，可以这样子写: <code>/tmp/go/src/nlp/dict/...</code></p>
<p>成功后，可以看到生成了一个新的文件:<code>/tmp/go/src/nlp/asset/asset.go</code></p>
<p>使用例子:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">import <span style="color:#f92672">(</span>
	<span style="color:#e6db74">&#34;nlp/asset&#34;</span>
<span style="color:#f92672">)</span>

func init<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;init --&gt; %v\n&#34;</span>, asset.AssetNames<span style="color:#f92672">())</span>
	loadDict<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;dict/adv_full.txt&#34;</span>, &amp;advMap<span style="color:#f92672">)</span>
	loadDict<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;dict/neg_full.txt&#34;</span>, &amp;negMap<span style="color:#f92672">)</span>
	loadDict<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;dict/not_full.txt&#34;</span>, &amp;notMap<span style="color:#f92672">)</span>
	loadDict<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;dict/pos_full.txt&#34;</span>, &amp;posMap<span style="color:#f92672">)</span>
	loadDict<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;dict/stp_full.txt&#34;</span>, &amp;stpMap<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

func loadDict<span style="color:#f92672">(</span>path string, dic *map<span style="color:#f92672">[</span>string<span style="color:#f92672">]</span>bool<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
	//<span style="color:#e6db74">&#34;dict/adv_full.txt&#34;</span>
	data, _ :<span style="color:#f92672">=</span> asset.Asset<span style="color:#f92672">(</span>path<span style="color:#f92672">)</span>
	bufferReader :<span style="color:#f92672">=</span> bytes.NewReader<span style="color:#f92672">(</span>data<span style="color:#f92672">)</span>
	scan :<span style="color:#f92672">=</span> bufio.NewScanner<span style="color:#f92672">(</span>bufferReader<span style="color:#f92672">)</span>
	<span style="color:#66d9ef">for</span> scan.Scan<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
		t :<span style="color:#f92672">=</span> scan.Text<span style="color:#f92672">()</span>
		<span style="color:#f92672">(</span>*dic<span style="color:#f92672">)[</span>t<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> true
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>因为我们添加了<code>-prefix &quot;/tmp/go/src/nlp/&quot;</code>, 所以，我们可以直接这样子： <code>dict/adv_full.txt</code>的路径，就可以通过<code>asset.Asset(&quot;dict/adv_full.txt&quot;)</code>来访问我们的静态资源了.</p>
<h3 id="常用编译选项">常用编译选项</h3>
<p>输出所有可用编译选项:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">go tool compile -help
</code></pre></div><h4 id="去掉调试信息">去掉调试信息</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">go build -ldflags <span style="color:#e6db74">&#39;-w&#39;</span>
</code></pre></div><h4 id="查看优化的信息内联-inline-信息逃逸分析等">查看优化的信息(内联 inline 信息、逃逸分析等)</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">go build -gcflags<span style="color:#f92672">=</span>-m 
</code></pre></div><h2 id="数组与slice-区别">数组与slice 区别</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package main

import <span style="color:#e6db74">&#34;fmt&#34;</span>

func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	arr :<span style="color:#f92672">=</span> <span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>int<span style="color:#f92672">{</span>0, 1, 2, 3, 4, 5, 6, 7, 8, 9<span style="color:#f92672">}</span>
	sliceArray :<span style="color:#f92672">=</span> arr<span style="color:#f92672">[</span>3:5<span style="color:#f92672">]</span>

	// 由此可知，slice是一种引用类型，因为它的第一个元素地址，与arr<span style="color:#f92672">[</span>3<span style="color:#f92672">]</span>的地址是一样的
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;arr[3] address = %v\n&#34;</span>, &amp;arr<span style="color:#f92672">[</span>3<span style="color:#f92672">])</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;sliceArray[0] address = %v\n&#34;</span>, &amp;sliceArray<span style="color:#f92672">[</span>0<span style="color:#f92672">])</span>

	// len <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;len slice = %v\n&#34;</span>, len<span style="color:#f92672">(</span>sliceArray<span style="color:#f92672">))</span>

	// cap <span style="color:#f92672">=</span> 7，cap的计算，是从第一个slice元素的位置，到原数组的结尾的长度.
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cap slice = %v\n&#34;</span>, cap<span style="color:#f92672">(</span>sliceArray<span style="color:#f92672">))</span>

	// 因为sliceArray的cap为7,已经存在2个，那还可以容纳5个元素，这时引用的，还是arr数组，这样子append后，会修改arr的内容
	// arr 为 : <span style="color:#f92672">[</span><span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span> 5<span style="color:#f92672">]</span>
	// sliceArray 为 : <span style="color:#f92672">[</span><span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">5</span>
	sliceArray <span style="color:#f92672">=</span> append<span style="color:#f92672">(</span>sliceArray, 1, 2, 3, 4, 5<span style="color:#f92672">)</span>

	// 当cap还在arr容纳范围之内时，slice指向的就是arr,通过打印他们的地址可知:
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;arr[5] address = %v， value=%v\n&#34;</span>, &amp;arr<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>, arr<span style="color:#f92672">[</span>6<span style="color:#f92672">])</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;sliceArray[2] address = %v, value=%v\n&#34;</span>, &amp;sliceArray<span style="color:#f92672">[</span>3<span style="color:#f92672">]</span>, sliceArray<span style="color:#f92672">[</span>3<span style="color:#f92672">])</span>

	//但当sliceArray超过了cap时: <span style="color:#f92672">[</span><span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span> 5<span style="color:#f92672">]</span>
	sliceArray <span style="color:#f92672">=</span> append<span style="color:#f92672">(</span>sliceArray, 1, 2, 3, 4, 5<span style="color:#f92672">)</span>
	// 可以发现，它指向了一个新的数组:因为他们的地址不同了.
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;arr[5] address = %v， value=%v\n&#34;</span>, &amp;arr<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>, arr<span style="color:#f92672">[</span>6<span style="color:#f92672">])</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;sliceArray[2] address = %v, value=%v\n&#34;</span>, &amp;sliceArray<span style="color:#f92672">[</span>3<span style="color:#f92672">]</span>, sliceArray<span style="color:#f92672">[</span>3<span style="color:#f92672">])</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cap slice = %v\n&#34;</span>, cap<span style="color:#f92672">(</span>sliceArray<span style="color:#f92672">))</span>

	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%v, %v\n&#34;</span>, arr, sliceArray<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>append超出cap之前与之后：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package main

import <span style="color:#e6db74">&#34;fmt&#34;</span>

func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	arr :<span style="color:#f92672">=</span> <span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>int<span style="color:#f92672">{</span>0, 1, 2, 3, 4, 5, 6, 7, 8, 9<span style="color:#f92672">}</span>
	sliceArray :<span style="color:#f92672">=</span> arr<span style="color:#f92672">[</span>3:5<span style="color:#f92672">]</span>
	sliceArray2 :<span style="color:#f92672">=</span> arr<span style="color:#f92672">[</span>3:5<span style="color:#f92672">]</span>

	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%v, %v, %v\n&#34;</span>, arr, sliceArray, sliceArray2<span style="color:#f92672">)</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%v, %v, %v\n&#34;</span>, &amp;arr<span style="color:#f92672">[</span>3<span style="color:#f92672">]</span>, &amp;sliceArray<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>, &amp;sliceArray2<span style="color:#f92672">[</span>0<span style="color:#f92672">])</span>

	sliceArray <span style="color:#f92672">=</span> append<span style="color:#f92672">(</span>sliceArray, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23<span style="color:#f92672">)</span>

	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%v, %v, %v\n&#34;</span>, arr, sliceArray, sliceArray2<span style="color:#f92672">)</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%v, %v, %v\n&#34;</span>, &amp;arr<span style="color:#f92672">[</span>3<span style="color:#f92672">]</span>, &amp;sliceArray<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>, &amp;sliceArray2<span style="color:#f92672">[</span>0<span style="color:#f92672">])</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="go中使用-redis">Go中使用 redis</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package main

import <span style="color:#f92672">(</span>
	<span style="color:#e6db74">&#34;flag&#34;</span>
	<span style="color:#e6db74">&#34;time&#34;</span>

	<span style="color:#e6db74">&#34;fmt&#34;</span>

	<span style="color:#e6db74">&#34;github.com/garyburd/redigo/redis&#34;</span>
<span style="color:#f92672">)</span>

func newPool<span style="color:#f92672">(</span>server, password string<span style="color:#f92672">)</span> *redis.Pool <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">return</span> &amp;redis.Pool<span style="color:#f92672">{</span>
		MaxIdle:     3,
		IdleTimeout: <span style="color:#ae81ff">240</span> * time.Second,
		Dial: func<span style="color:#f92672">()</span> <span style="color:#f92672">(</span>redis.Conn, error<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			c, err :<span style="color:#f92672">=</span> redis.Dial<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;tcp&#34;</span>, server<span style="color:#f92672">)</span>
			<span style="color:#66d9ef">if</span> err !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
				<span style="color:#66d9ef">return</span> nil, err
			<span style="color:#f92672">}</span>
			<span style="color:#66d9ef">if</span> len<span style="color:#f92672">(</span>password<span style="color:#f92672">)</span> &gt; <span style="color:#ae81ff">0</span> <span style="color:#f92672">{</span>
				<span style="color:#66d9ef">if</span> _, err :<span style="color:#f92672">=</span> c.Do<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;AUTH&#34;</span>, password<span style="color:#f92672">)</span>; err !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
					c.Close<span style="color:#f92672">()</span>
					<span style="color:#66d9ef">return</span> nil, err
				<span style="color:#f92672">}</span>
			<span style="color:#f92672">}</span>
			<span style="color:#66d9ef">return</span> c, err
		<span style="color:#f92672">}</span>,
		TestOnBorrow: func<span style="color:#f92672">(</span>c redis.Conn, t time.Time<span style="color:#f92672">)</span> error <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">if</span> time.Since<span style="color:#f92672">(</span>t<span style="color:#f92672">)</span> &lt; time.Minute <span style="color:#f92672">{</span>
				<span style="color:#66d9ef">return</span> nil
			<span style="color:#f92672">}</span>
			_, err :<span style="color:#f92672">=</span> c.Do<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;PING&#34;</span><span style="color:#f92672">)</span>
			<span style="color:#66d9ef">return</span> err
		<span style="color:#f92672">}</span>,
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

var <span style="color:#f92672">(</span>
	pool          *redis.Pool
	redisServer   <span style="color:#f92672">=</span> flag.String<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;redisServer&#34;</span>, <span style="color:#e6db74">&#34;:6379&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span>
	redisPassword <span style="color:#f92672">=</span> flag.String<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;redisPassword&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span>
<span style="color:#f92672">)</span>

func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	redisGet<span style="color:#f92672">()</span>
	redisPipline<span style="color:#f92672">()</span>
<span style="color:#f92672">}</span>

func redisGet<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	redisConnection :<span style="color:#f92672">=</span> pool.Get<span style="color:#f92672">()</span>
	defer redisConnection.Close<span style="color:#f92672">()</span>

	//如果这个不为空，表明获取链接时出错
	<span style="color:#66d9ef">if</span> redisConnection.Err<span style="color:#f92672">()</span> !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
		fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello World %v\n&#34;</span>, redisConnection.Err<span style="color:#f92672">()</span>.Error<span style="color:#f92672">())</span>
		<span style="color:#66d9ef">return</span>
	<span style="color:#f92672">}</span>

	val, err :<span style="color:#f92672">=</span> redisConnection.Do<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;hello2&#34;</span><span style="color:#f92672">)</span>
	<span style="color:#66d9ef">if</span> err <span style="color:#f92672">==</span> nil <span style="color:#f92672">{</span>
		fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello %v\n&#34;</span>, string<span style="color:#f92672">(</span>val.<span style="color:#f92672">([]</span>uint8<span style="color:#f92672">)))</span>
	<span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
		fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;happen error : %v\n&#34;</span>, err.Error<span style="color:#f92672">())</span>
	<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

func redisPipline<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	redisConnection :<span style="color:#f92672">=</span> pool.Get<span style="color:#f92672">()</span>
	defer redisConnection.Close<span style="color:#f92672">()</span>

	//如果这个不为空，表明获取链接时出错
	<span style="color:#66d9ef">if</span> redisConnection.Err<span style="color:#f92672">()</span> !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
		fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello World %v\n&#34;</span>, redisConnection.Err<span style="color:#f92672">()</span>.Error<span style="color:#f92672">())</span>
		<span style="color:#66d9ef">return</span>
	<span style="color:#f92672">}</span>

	redisConnection.Send<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">)</span>
	redisConnection.Send<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;hello1&#34;</span><span style="color:#f92672">)</span>
	redisConnection.Send<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;hello2&#34;</span><span style="color:#f92672">)</span>

	redisConnection.Flush<span style="color:#f92672">()</span>

	<span style="color:#66d9ef">for</span> i :<span style="color:#f92672">=</span> 0; i &lt; 3; i++ <span style="color:#f92672">{</span>
		data, err :<span style="color:#f92672">=</span> redisConnection.Receive<span style="color:#f92672">()</span>

		<span style="color:#66d9ef">if</span> err <span style="color:#f92672">==</span> nil <span style="color:#f92672">&amp;&amp;</span> redisConnection.Err<span style="color:#f92672">()</span> <span style="color:#f92672">==</span> nil <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">if</span> data <span style="color:#f92672">==</span> nil <span style="color:#f92672">{</span>
				<span style="color:#66d9ef">continue</span>
			<span style="color:#f92672">}</span>
			fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello from pipline %v\n&#34;</span>, string<span style="color:#f92672">(</span>data.<span style="color:#f92672">([]</span>uint8<span style="color:#f92672">)))</span>
			<span style="color:#66d9ef">continue</span>
		<span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
			fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello from pipline error %v\n&#34;</span>, err.Error<span style="color:#f92672">())</span>
			break
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;done\n&#34;</span><span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

func init<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	flag.Parse<span style="color:#f92672">()</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;redis: server = %v, passwd = %v\n&#34;</span>, *redisServer, *redisPassword<span style="color:#f92672">)</span>
	pool <span style="color:#f92672">=</span> newPool<span style="color:#f92672">(</span>*redisServer, *redisPassword<span style="color:#f92672">)</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;init redis connection pool ok\n&#34;</span><span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>


</code></pre></div><p>注意，这个默认是<code>db 0</code>，如果想实现选择（虽然不推荐使用多个DB），可以按如下链接做:</p>
<p><a href="http://stackoverflow.com/questions/25708256/golang-selecting-db-on-a-redispool-in-redigo">stackoverflow</a></p>
<h2 id="go-中使用-gorm-与-mysql-交互">Go 中使用 gorm 与 mysql 交互</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package main

import <span style="color:#f92672">(</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>

	<span style="color:#e6db74">&#34;time&#34;</span>

	<span style="color:#e6db74">&#34;github.com/jinzhu/gorm&#34;</span>
	_ <span style="color:#e6db74">&#34;github.com/jinzhu/gorm/dialects/mysql&#34;</span>
<span style="color:#f92672">)</span>

type WbStatus struct <span style="color:#f92672">{</span>
	ID       int64 <span style="color:#e6db74">`</span>gorm:<span style="color:#e6db74">&#34;primary_key&#34;</span><span style="color:#e6db74">`</span>
	Text     string
	CreateAt time.Time
<span style="color:#f92672">}</span>

func <span style="color:#f92672">(</span>WbStatus<span style="color:#f92672">)</span> TableName<span style="color:#f92672">()</span> string <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;wb_status&#34;</span>
<span style="color:#f92672">}</span>

var db *gorm.DB

func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">if</span> db <span style="color:#f92672">==</span> nil <span style="color:#f92672">{</span>
		panic<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;db is nil&#34;</span><span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span>
	var wbstatus WbStatus
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;tableName = %v\n&#34;</span>, wbstatus.TableName<span style="color:#f92672">())</span>
	db.First<span style="color:#f92672">(</span>&amp;wbstatus<span style="color:#f92672">)</span>

	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;rowId = %v\n&#34;</span>, wbstatus.ID<span style="color:#f92672">)</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;createAt = %v\n&#34;</span>, wbstatus.CreateAt<span style="color:#f92672">)</span>
	defer db.Close<span style="color:#f92672">()</span>
<span style="color:#f92672">}</span>

func init<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	var err error
	db, err <span style="color:#f92672">=</span> gorm.Open<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;mysql&#34;</span>, <span style="color:#e6db74">&#34;root:yang@(127.0.0.1:3306)/test?charset=utf8&amp;parseTime=True&amp;loc=Local&#34;</span><span style="color:#f92672">)</span>
	<span style="color:#66d9ef">if</span> err !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
		fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;init mysql error : %v\n&#34;</span>, err.Error<span style="color:#f92672">())</span>
		panic<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;exit&#34;</span><span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">if</span> db <span style="color:#f92672">==</span> nil <span style="color:#f92672">{</span>
		fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;init mysql error : db is null\n&#34;</span><span style="color:#f92672">)</span>
		panic<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;exit&#34;</span><span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
		fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;init mysql  : db isnot null\n&#34;</span><span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span>
	db.DB<span style="color:#f92672">()</span>.SetMaxOpenConns<span style="color:#f92672">(</span>100<span style="color:#f92672">)</span>
	db.DB<span style="color:#f92672">()</span>.SetMaxIdleConns<span style="color:#f92672">(</span>10<span style="color:#f92672">)</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;init mysql OK\n&#34;</span><span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

</code></pre></div><p><a href="http://jinzhu.me/gorm/">gorm</a></p>
<h2 id="go-中使用-rabbitmq">go 中使用 rabbitmq</h2>
<p><a href="https://github.com/streadway/amqp">github amqp</a></p>
<p><a href="http://stackoverflow.com/questions/36179111/whether-to-create-connection-every-time-when-amqp-dial-is-threadsafe-or-not-in-g">whether-to-create-connection-every-time-when-amqp-dial-is-threadsafe-or-not-in-golang</a></p>
<p><a href="https://ninefinity.org/post/ensuring-rabbitmq-connection-in-golang/">ensuring-rabbitmq-connection-in-golang</a></p>
<h3 id="注意事项">注意事项</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ch, _ :<span style="color:#f92672">=</span> mqCon.Channel<span style="color:#f92672">()</span>
	msgs, err :<span style="color:#f92672">=</span> ch.Consume<span style="color:#f92672">(</span>
		config.Configuration.Rabbit.Listen,     // queue
		config.Configuration.Rabbit.ConsumerID, // consumer
		true,  // auto-ack
		false, // exclusive
		false, // no-local
		false, // no-wait
		nil,   // args
	<span style="color:#f92672">)</span>
</code></pre></div><p>如果你将<code>auto-ack</code>设置为true，则不用手工确认消息。如果设置为<code>false</code>，则必须手工调用:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Delivery.Ack, Delivery.Reject or Delivery.Nack
</code></pre></div><p><a href="https://agocs.org/blog/2014/08/19/rabbitmq-best-practices-in-go/">rabbitmq-best-practices-in-go</a></p>
<p><code>autoAck</code>:</p>
<blockquote>
<p>When autoAck (also known as noAck) is true, the server will acknowledge
deliveries to this consumer prior to writing the delivery to the network.  When
autoAck is true, the consumer should not call Delivery.Ack.  Automatically
acknowledging deliveries means that some deliveries may get lost if the
consumer is unable to process them after the server delivers them.</p>
</blockquote>
<h2 id="go中long与timestamp-json的转换">go中long与timestamp json的转换</h2>
<p><a href="http://stackoverflow.com/questions/31744970/convert-to-time-in-golang-from-milliseconds">convert-to-time-in-golang-from-milliseconds</a></p>
<p><code>type A B只是让A获得B的内存模型而已。A不会继承B的方法，但A和B可以使用A()或B()来互相转换。</code></p>
<p><a href="http://golangtc.com/t/57fdbb43b09ecc08ce000121">golangtc</a></p>
<h2 id="go-中找出实现了某接口的代码">Go 中找出实现了某接口的代码</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">egrep -nr <span style="color:#e6db74">&#39;^func (.*) ReadByte\(&#39;</span> *
</code></pre></div><h2 id="golang中实现优雅关闭程序">Golang中实现优雅关闭程序</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>

	sigs :<span style="color:#f92672">=</span> make<span style="color:#f92672">(</span>chan os.Signal, 1<span style="color:#f92672">)</span>
	<span style="color:#66d9ef">done</span> :<span style="color:#f92672">=</span> make<span style="color:#f92672">(</span>chan bool, 1<span style="color:#f92672">)</span>

	// sigs 表示将收到的信号放到这个管道中。后面的参数表示你想处理的系统信号
	signal.Notify<span style="color:#f92672">(</span>sigs, syscall.SIGINT, syscall.SIGTERM<span style="color:#f92672">)</span>

	//开启一个Go routine来监听信号
	go func<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
		sig :<span style="color:#f92672">=</span> &lt;-sigs
		<span style="color:#66d9ef">done</span> &lt;- true
	<span style="color:#f92672">}()</span>

	//这里添加你的程序的功能（监听器，处理器等）
	fmt.Println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;awaiting signal&#34;</span><span style="color:#f92672">)</span>
	&lt;-done
	fmt.Println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;exiting&#34;</span><span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>常见信号:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Signal Name	Number	Description
SIGHUP	1	Hangup <span style="color:#f92672">(</span>POSIX<span style="color:#f92672">)</span>
SIGINT	2	Terminal interrupt <span style="color:#f92672">(</span>ANSI<span style="color:#f92672">)</span>
SIGQUIT	3	Terminal quit <span style="color:#f92672">(</span>POSIX<span style="color:#f92672">)</span>
SIGILL	4	Illegal instruction <span style="color:#f92672">(</span>ANSI<span style="color:#f92672">)</span>
SIGTRAP	5	Trace trap <span style="color:#f92672">(</span>POSIX<span style="color:#f92672">)</span>
SIGIOT	6	IOT Trap <span style="color:#f92672">(</span>4.2 BSD<span style="color:#f92672">)</span>
SIGBUS	7	BUS error <span style="color:#f92672">(</span>4.2 BSD<span style="color:#f92672">)</span>
SIGFPE	8	Floating point exception <span style="color:#f92672">(</span>ANSI<span style="color:#f92672">)</span>
SIGKILL	9	Kill<span style="color:#f92672">(</span>can<span style="color:#e6db74">&#39;t be caught or ignored) (POSIX)
</span><span style="color:#e6db74">SIGUSR1	10	User defined signal 1 (POSIX)
</span><span style="color:#e6db74">SIGSEGV	11	Invalid memory segment access (ANSI)
</span><span style="color:#e6db74">SIGUSR2	12	User defined signal 2 (POSIX)
</span><span style="color:#e6db74">SIGPIPE	13	Write on a pipe with no reader, Broken pipe (POSIX)
</span><span style="color:#e6db74">SIGALRM	14	Alarm clock (POSIX)
</span><span style="color:#e6db74">SIGTERM	15	Termination (ANSI)
</span><span style="color:#e6db74">SIGSTKFLT	16	Stack fault
</span><span style="color:#e6db74">SIGCHLD	17	Child process has stopped or exited, changed (POSIX)
</span><span style="color:#e6db74">SIGCONT	18	Continue executing, if stopped (POSIX)
</span><span style="color:#e6db74">SIGSTOP	19	Stop executing(can&#39;</span>t be caught or ignored<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>POSIX<span style="color:#f92672">)</span>
SIGTSTP	20	Terminal stop signal <span style="color:#f92672">(</span>POSIX<span style="color:#f92672">)</span>
SIGTTIN	21	Background process trying to read, from TTY <span style="color:#f92672">(</span>POSIX<span style="color:#f92672">)</span>
SIGTTOU	22	Background process trying to write, to TTY <span style="color:#f92672">(</span>POSIX<span style="color:#f92672">)</span>
SIGURG	23	Urgent condition on socket <span style="color:#f92672">(</span>4.2 BSD<span style="color:#f92672">)</span>
SIGXCPU	24	CPU limit exceeded <span style="color:#f92672">(</span>4.2 BSD<span style="color:#f92672">)</span>
SIGXFSZ	25	File size limit exceeded <span style="color:#f92672">(</span>4.2 BSD<span style="color:#f92672">)</span>
SIGVTALRM	26	Virtual alarm clock <span style="color:#f92672">(</span>4.2 BSD<span style="color:#f92672">)</span>
SIGPROF	27	Profiling alarm clock <span style="color:#f92672">(</span>4.2 BSD<span style="color:#f92672">)</span>
SIGWINCH	28	Window size change <span style="color:#f92672">(</span>4.3 BSD, Sun<span style="color:#f92672">)</span>
SIGIO	29	I/O now possible <span style="color:#f92672">(</span>4.2 BSD<span style="color:#f92672">)</span>
SIGPWR	30	Power failure restart <span style="color:#f92672">(</span>System V<span style="color:#f92672">)</span>
</code></pre></div><h3 id="检查程序监控了哪些信号">检查程序监控了哪些信号</h3>
<p><a href="http://unix.stackexchange.com/questions/85364/how-can-i-check-what-signals-a-process-is-listening-to">signals</a></p>
<h2 id="golang中的struct-tag使用">Golang中的struct tag使用</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package main

import <span style="color:#f92672">(</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;reflect&#34;</span>
<span style="color:#f92672">)</span>

// Person :
type Person struct <span style="color:#f92672">{</span>
	Name string <span style="color:#e6db74">`</span>mytag:<span style="color:#e6db74">&#34;HelloName&#34;</span><span style="color:#e6db74">`</span>
<span style="color:#f92672">}</span>

func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	p :<span style="color:#f92672">=</span> Person<span style="color:#f92672">{</span>Name: <span style="color:#e6db74">&#34;emacsist&#34;</span><span style="color:#f92672">}</span>
	refValue :<span style="color:#f92672">=</span> reflect.ValueOf<span style="color:#f92672">(</span>&amp;p<span style="color:#f92672">)</span>

	fields :<span style="color:#f92672">=</span> refValue.Elem<span style="color:#f92672">()</span>
	<span style="color:#66d9ef">for</span> i :<span style="color:#f92672">=</span> 0; i &lt; fields.NumField<span style="color:#f92672">()</span>; i++ <span style="color:#f92672">{</span>
		field :<span style="color:#f92672">=</span> fields.Field<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span>
		fieldName :<span style="color:#f92672">=</span> fields.Type<span style="color:#f92672">()</span>.Field<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span>.Name
		fieldValue :<span style="color:#f92672">=</span> field.Interface<span style="color:#f92672">()</span>
		fieldTag :<span style="color:#f92672">=</span> fields.Type<span style="color:#f92672">()</span>.Field<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span>.Tag.Get<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;mytag&#34;</span><span style="color:#f92672">)</span>
		fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;fieldName = %v, fieldValue = %v, tagName = %v\n&#34;</span>, fieldName, fieldValue, fieldTag<span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><h2 id="限制goalng的http-工作线程goroutine">限制Goalng的HTTP 工作线程(goroutine)</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">	connectionCount :<span style="color:#f92672">=</span> <span style="color:#ae81ff">5000</span>

	l, err :<span style="color:#f92672">=</span> net.Listen<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;tcp&#34;</span>, <span style="color:#e6db74">&#34;:9090&#34;</span><span style="color:#f92672">)</span>

	<span style="color:#66d9ef">if</span> err !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
		log.Fatalf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Listen: %v&#34;</span>, err<span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span>

	l <span style="color:#f92672">=</span> netutil.LimitListener<span style="color:#f92672">(</span>l, connectionCount<span style="color:#f92672">)</span>
	log.Fatal<span style="color:#f92672">(</span>http.Serve<span style="color:#f92672">(</span>l, nil<span style="color:#f92672">))</span>
	logrus.Infof<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;start server success. %v&#34;</span>, ListenAddress<span style="color:#f92672">)</span>
</code></pre></div><h2 id="为什么我的内存没有被操作系统回收">为什么我的内存没有被操作系统回收？</h2>
<p><a href="http://stackoverflow.com/questions/24376817/go-1-3-garbage-collector-not-releasing-server-memory-back-to-system">stackoverflow</a></p>
<p><a href="https://golang.org/pkg/runtime/debug/">golang</a></p>
<h2 id="golang18-中的优雅关闭-http">Golang1.8 中的优雅关闭 http</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">
	<span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Server</span>{
		<span style="color:#a6e22e">Addr</span>: <span style="color:#e6db74">&#34;:9090&#34;</span>,
	}
	<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Infof</span>(<span style="color:#e6db74">&#34;%s&#34;</span>, <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">ListenAndServe</span>())
	}()
	<span style="color:#75715e">// Handle SIGINT and SIGTERM.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">ch</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Signal</span>)
	<span style="color:#a6e22e">signal</span>.<span style="color:#a6e22e">Notify</span>(<span style="color:#a6e22e">ch</span>, <span style="color:#a6e22e">syscall</span>.<span style="color:#a6e22e">SIGINT</span>, <span style="color:#a6e22e">syscall</span>.<span style="color:#a6e22e">SIGTERM</span>)
	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">ch</span>)

	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;http server gracefully stopping...&#34;</span>)
	<span style="color:#75715e">// Stop the service gracefully.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Shutdown</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>())
	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;http server gracefully shutdown done...&#34;</span>)

</code></pre></div><h2 id="按-github-风格的项目组织结构">按 github 风格的项目组织结构</h2>
<p><a href="https://github.com/golang/go/wiki/GithubCodeLayout">github code layout</a></p>
<h2 id="压缩编译后的文件大小">压缩编译后的文件大小</h2>
<h3 id="去掉符号信息">去掉符号信息</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">go build -ldflags <span style="color:#e6db74">&#34;-s -w&#34;</span>
</code></pre></div><h3 id="使用-upx-压缩">使用 upx 压缩</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">upx -9 GoBinaryFile
</code></pre></div><h2 id="golang-中的-web">Golang 中的 web</h2>
<p>在 web 中使用 panic 只会退出当前的 goroutine ，而不会整个应用程序退出。</p>
<p>在一般应用中，如果没有捕捉 panic() 的话，就会导致整个应用退出:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package main

import <span style="color:#f92672">(</span>
	<span style="color:#e6db74">&#34;sync&#34;</span>
	<span style="color:#e6db74">&#34;time&#34;</span>
<span style="color:#f92672">)</span>

func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	wg :<span style="color:#f92672">=</span> sync.WaitGroup<span style="color:#f92672">{}</span>
	wg.Add<span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>
	go func<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
		time.Sleep<span style="color:#f92672">(</span><span style="color:#ae81ff">5</span> * time.Second<span style="color:#f92672">)</span>
		println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello World&#34;</span><span style="color:#f92672">)</span>
		panic<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;==================&gt;&#34;</span><span style="color:#f92672">)</span>
	<span style="color:#f92672">}()</span>

	go func<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
		time.Sleep<span style="color:#f92672">(</span><span style="color:#ae81ff">2</span> * time.Second<span style="color:#f92672">)</span>
		println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello World2&#34;</span><span style="color:#f92672">)</span>
		panic<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;==================&gt;2&#34;</span><span style="color:#f92672">)</span>
	<span style="color:#f92672">}()</span>
	wg.Wait<span style="color:#f92672">()</span>
<span style="color:#f92672">}</span>

</code></pre></div><h2 id="短声明注意">短声明注意</h2>
<p>短声明只能声明局部变量，而且它会覆盖外部的同名变量。</p>
<p>所以，如果目的是想进行外部变量的初始化的话，这点可能没达到我们想要的目的，这点要特别注意。</p>
<h2 id="类型转换">类型转换</h2>
<p>不论显式还是隐式的 <em>常量</em> 的类型转换，常量从一种类型转换为另一种类型，都要求目标类型能够表示 <em>原值</em></p>
<h2 id="golang-中格式化日期">Golang 中格式化日期</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">YYYY-MM-DD HH:mm:ss 
对应
2006-01-02 15:04:05
</code></pre></div><h2 id="go-中发送登录请求保持-cookie">Go 中发送登录请求（保持 cookie)</h2>
<p><a href="https://stackoverflow.com/questions/18414212/golang-how-to-follow-location-with-cookie">stackoverflow.com</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package main

import <span style="color:#f92672">(</span>
    <span style="color:#e6db74">&#34;golang.org/x/net/publicsuffix&#34;</span>
    <span style="color:#e6db74">&#34;io/ioutil&#34;</span>
    <span style="color:#e6db74">&#34;log&#34;</span>
    <span style="color:#e6db74">&#34;net/http&#34;</span>
    <span style="color:#e6db74">&#34;net/http/cookiejar&#34;</span>
<span style="color:#f92672">)</span>

func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    options :<span style="color:#f92672">=</span> cookiejar.Options<span style="color:#f92672">{</span>
        PublicSuffixList: publicsuffix.List,
    <span style="color:#f92672">}</span>
    jar, err :<span style="color:#f92672">=</span> cookiejar.New<span style="color:#f92672">(</span>&amp;options<span style="color:#f92672">)</span>
    <span style="color:#66d9ef">if</span> err !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
        log.Fatal<span style="color:#f92672">(</span>err<span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
    client :<span style="color:#f92672">=</span> http.Client<span style="color:#f92672">{</span>Jar: jar<span style="color:#f92672">}</span>
    resp, err :<span style="color:#f92672">=</span> client.Get<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;http://dubbelboer.com/302cookie.php&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">if</span> err !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
        log.Fatal<span style="color:#f92672">(</span>err<span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
    data, err :<span style="color:#f92672">=</span> ioutil.ReadAll<span style="color:#f92672">(</span>resp.Body<span style="color:#f92672">)</span>
    resp.Body.Close<span style="color:#f92672">()</span>
    <span style="color:#66d9ef">if</span> err !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
        log.Fatal<span style="color:#f92672">(</span>err<span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
    log.Println<span style="color:#f92672">(</span>string<span style="color:#f92672">(</span>data<span style="color:#f92672">))</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="go-中提交表单">Go 中提交表单</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
	form :<span style="color:#f92672">=</span> url.Values<span style="color:#f92672">{}</span>
	form.Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;qps&#34;</span>, strconv.FormatInt<span style="color:#f92672">(</span>qps, 10<span style="color:#f92672">))</span>


	setQPSRequest, err :<span style="color:#f92672">=</span> http.NewRequest<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;POST&#34;</span>, loginURL, strings.NewReader<span style="color:#f92672">(</span>form.Encode<span style="color:#f92672">()))</span>
	<span style="color:#66d9ef">if</span> err !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">return</span>
	<span style="color:#f92672">}</span>

	setQPSRequest.Header.Set<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Content-Type&#34;</span>, <span style="color:#e6db74">&#34;application/x-www-form-urlencoded; charset=utf-8&#34;</span><span style="color:#f92672">)</span>
</code></pre></div><h2 id="logrus-设置日志时间格式">logrus 设置日志时间格式</h2>
<p>logrus 设置日期</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">func init<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	formatter :<span style="color:#f92672">=</span> &amp;logrus.TextFormatter<span style="color:#f92672">{</span>
		FullTimestamp: true,
	<span style="color:#f92672">}</span>
	logrus.SetFormatter<span style="color:#f92672">(</span>formatter<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="go-中自动重连-rabbitmq">Go 中自动重连 RabbitMQ</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">var <span style="color:#f92672">(</span>
	connectionDone <span style="color:#f92672">=</span> make<span style="color:#f92672">(</span>chan *amqp.Error<span style="color:#f92672">)</span>
	conn           *amqp.Connection
	channel        *amqp.Channel
<span style="color:#f92672">)</span>

func failOnError<span style="color:#f92672">(</span>err error, msg string<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">if</span> err !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
		log.Fatalf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%s: %s&#34;</span>, msg, err<span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

func init<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	connectToRabbitMQ<span style="color:#f92672">()</span>
	go rabbitConnector<span style="color:#f92672">()</span>
<span style="color:#f92672">}</span>

func connectToRabbitMQ<span style="color:#f92672">()</span> *amqp.Connection <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">for</span> <span style="color:#f92672">{</span>
		conn, err :<span style="color:#f92672">=</span> amqp.Dial<span style="color:#f92672">(</span>config.AppConfig.GetAmqpUrl<span style="color:#f92672">())</span>

		<span style="color:#66d9ef">if</span> err <span style="color:#f92672">==</span> nil <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">if</span> channel !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
				//要先关闭之前的 channel
				log.Warnf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;close before channel&#34;</span><span style="color:#f92672">)</span>
				channel.Close<span style="color:#f92672">()</span>
			<span style="color:#f92672">}</span>
			channel, _ <span style="color:#f92672">=</span> conn.Channel<span style="color:#f92672">()</span>
			log.Infof<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;conn address = %p, channel address =%p&#34;</span>, config.AppConfig.GetAmqpUrl<span style="color:#f92672">()</span>, channel<span style="color:#f92672">)</span>
			<span style="color:#66d9ef">return</span> conn
		<span style="color:#f92672">}</span>
		log.Errorf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;error connect to rabbitmq. %s&#34;</span>, err.Error<span style="color:#f92672">())</span>
		log.Warnf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Trying to reconnect to RabbitMQ at %v&#34;</span>, config.AppConfig.GetAmqpUrl<span style="color:#f92672">())</span>
		time.Sleep<span style="color:#f92672">(</span><span style="color:#ae81ff">500</span> * time.Millisecond<span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

func rabbitConnector<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">for</span> <span style="color:#f92672">{</span>
		closeEvent :<span style="color:#f92672">=</span> &lt;-connectionDone
		<span style="color:#66d9ef">if</span> closeEvent !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
			log.Errorf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;receive connection closed event!&#34;</span><span style="color:#f92672">)</span>
			log.Errorf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Connecting to %v&#34;</span>, config.AppConfig.GetAmqpUrl<span style="color:#f92672">())</span>
			//每一次创建时，都要用新的 chan 对象来接收通知。否则会报 panic: send on closed channel
			// update 2017-4-14
			connectionDone <span style="color:#f92672">=</span> make<span style="color:#f92672">(</span>chan *amqp.Error<span style="color:#f92672">)</span>
			conn <span style="color:#f92672">=</span> connectToRabbitMQ<span style="color:#f92672">()</span>
			conn.NotifyClose<span style="color:#f92672">(</span>connectionDone<span style="color:#f92672">)</span>
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="go-中批量处理-sql">Go 中批量处理 SQL</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">	insertStatement :<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;INSERT OR  REPLACE INTO indice (index_name, static_pe, pe_ttm, static_pb, sse, last_year_static_pe, last_year_pe_ttm, last_year_pb, statis_date) VALUES &#34;</span>
	vals :<span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>interface<span style="color:#f92672">{}{}</span>

	<span style="color:#66d9ef">for</span> _, row :<span style="color:#f92672">=</span> range rows <span style="color:#f92672">{</span>
		insertStatement <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;(?, ?, ?, ?, ?, ?, ?, ?, ?),&#34;</span>
		vals <span style="color:#f92672">=</span> append<span style="color:#f92672">(</span>vals, row.Index_name, row.Static_pe, row.Pe_ttm, row.Static_pb, row.Sse, row.Last_year_static_pe, row.Last_year_pe_ttm, row.Last_year_pb, row.Pe_date<span style="color:#f92672">)</span>
		<span style="color:#66d9ef">if</span> Debug <span style="color:#f92672">{</span>
			log.Infof<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;row =&gt; %v&#34;</span>, row<span style="color:#f92672">)</span>
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>
	//删除最后的 ,
	insertStatement <span style="color:#f92672">=</span> insertStatement<span style="color:#f92672">[</span>0:len<span style="color:#f92672">(</span>insertStatement<span style="color:#f92672">)</span>-1<span style="color:#f92672">]</span>
	//prepare the statement

	<span style="color:#66d9ef">if</span> Debug <span style="color:#f92672">{</span>
		log.Infof<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;insertStatement =&gt; %v&#34;</span>, insertStatement<span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span>

	stmt, err :<span style="color:#f92672">=</span> db.Prepare<span style="color:#f92672">(</span>insertStatement<span style="color:#f92672">)</span>

	<span style="color:#66d9ef">if</span> err !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
		panic<span style="color:#f92672">(</span>err<span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span>

	res, _ :<span style="color:#f92672">=</span> stmt.Exec<span style="color:#f92672">(</span>vals...<span style="color:#f92672">)</span>

	effectRow, _ :<span style="color:#f92672">=</span> res.RowsAffected<span style="color:#f92672">()</span>
	fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;done.  affected %v&#34;</span>, effectRow<span style="color:#f92672">)</span>
</code></pre></div><h2 id="go-中处理-gbk-字符集">Go 中处理 GBK 字符集</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">导入

<span style="color:#e6db74">&#34;golang.org/x/text/encoding/simplifiedchinese&#34;</span>
<span style="color:#e6db74">&#34;golang.org/x/text/transform&#34;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">	robots, err :<span style="color:#f92672">=</span> ioutil.ReadAll<span style="color:#f92672">(</span>response.Body<span style="color:#f92672">)</span>

	sr :<span style="color:#f92672">=</span> strings.NewReader<span style="color:#f92672">(</span>string<span style="color:#f92672">(</span>robots<span style="color:#f92672">))</span>
	tr :<span style="color:#f92672">=</span> transform.NewReader<span style="color:#f92672">(</span>sr, simplifiedchinese.GB18030.NewDecoder<span style="color:#f92672">())</span>
	b, _ :<span style="color:#f92672">=</span> ioutil.ReadAll<span style="color:#f92672">(</span>tr<span style="color:#f92672">)</span>
	result :<span style="color:#f92672">=</span> string<span style="color:#f92672">(</span>b<span style="color:#f92672">)</span>
	<span style="color:#66d9ef">return</span> result
</code></pre></div><h2 id="go-中-get-请求的参数处理">Go 中 GET 请求的参数处理</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">	req, err :<span style="color:#f92672">=</span> http.NewRequest<span style="color:#f92672">(</span>http.MethodGet, CsindexUrl, nil<span style="color:#f92672">)</span>
    q :<span style="color:#f92672">=</span> req.URL.Query<span style="color:#f92672">()</span>
	q.Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;参数名&#34;</span>, <span style="color:#e6db74">&#34;参数值&#34;</span><span style="color:#f92672">)</span>
	req.URL.RawQuery <span style="color:#f92672">=</span> q.Encode<span style="color:#f92672">()</span>

    <span style="color:#75715e"># 添加 cookie</span>
    cookie1 :<span style="color:#f92672">=</span> &amp;http.Cookie<span style="color:#f92672">{</span>
		Name:  <span style="color:#e6db74">&#34;XSRF-TOKEN&#34;</span>,
		Value: <span style="color:#e6db74">&#34;eyJpdiI6ImYrZVwvM2k3YlF4NDhIRG1DU3A0cXNRPT0iLCJ2YWx1ZSI6IkdLc3NYUDBidVd3V3JUamY0a1FSb1pBVGxiVmxBYTRHRHBxTDRmUW92V2hhMjE1bUpPMGFOUStJSVg3RmdvdXQ0eFgrRDliSElod3hHdWRlRFwvbGo2Zz09IiwibWFjIjoiOTNjNWQyZjk0YjFjYWJjZTc3ZGE1ZjQ1Y2IyZGQzNmVjYTI3YWRiNDRmNjg2MjBkMDEzMGE2ODhkZTBmZTJhNiJ9&#34;</span>,
	<span style="color:#f92672">}</span>
	cookie2 :<span style="color:#f92672">=</span> &amp;http.Cookie<span style="color:#f92672">{</span>
		Name:  <span style="color:#e6db74">&#34;laravel_session&#34;</span>,
		Value: <span style="color:#e6db74">&#34;eyJpdiI6ImZzTlJMb0NZVHMwRElqcGYzd2FmZ0E9PSIsInZhbHVlIjoiRktjN2xNczl0Z0hlN09MMzRRcmlcL1RNazZQRXJhT1FTWnh1V2o3TzVnTGhcL2RVMys5aHAwRmxyTlBJRWFramlzd29KRnpOMFcxVW1kanVxZDEzajJ1UT09IiwibWFjIjoiNmJlOTFiMDkxY2NkOTkyNGI2NzdjYmM0YmI3MWZmYmU1NDI0OWI2ZDcwZjc0NTdjNDU1NDQ1YjM0YzJhMTc0OSJ9&#34;</span>,
	<span style="color:#f92672">}</span>

	req.AddCookie<span style="color:#f92672">(</span>cookie1<span style="color:#f92672">)</span>
	req.AddCookie<span style="color:#f92672">(</span>cookie2<span style="color:#f92672">)</span>

    response, err :<span style="color:#f92672">=</span> http.DefaultClient.Do<span style="color:#f92672">(</span>req<span style="color:#f92672">)</span>
</code></pre></div><h2 id="go-中调试-http-的-request-和-response">Go 中调试 http 的 request 和 response</h2>
<blockquote>
<p>这个类似 curl -v 的参数.</p>
</blockquote>
<p>这个要导入包 <code>&quot;net/http/httputil&quot;</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
debug<span style="color:#f92672">(</span>httputil.DumpRequestOut<span style="color:#f92672">(</span>req, true<span style="color:#f92672">))</span>


debug<span style="color:#f92672">(</span>httputil.DumpResponse<span style="color:#f92672">(</span>response, true<span style="color:#f92672">))</span>

func debug<span style="color:#f92672">(</span>data <span style="color:#f92672">[]</span>byte, err error<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">if</span> err <span style="color:#f92672">==</span> nil <span style="color:#f92672">{</span>
		fmt.Printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%s\n\n&#34;</span>, data<span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
		log.Fatalf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%s\n\n&#34;</span>, err<span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="go-中按行读取-string">Go 中按行读取 string</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">	scanner :<span style="color:#f92672">=</span> bufio.NewScanner<span style="color:#f92672">(</span>strings.NewReader<span style="color:#f92672">(</span>bodyString<span style="color:#f92672">))</span>
	<span style="color:#66d9ef">for</span> scanner.Scan<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
		line :<span style="color:#f92672">=</span> scanner.Text<span style="color:#f92672">()</span>
    <span style="color:#f92672">}</span>
</code></pre></div><h2 id="go-中按空格-split-字符串">Go 中按空格 split 字符串</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">fields :<span style="color:#f92672">=</span> strings.Fields<span style="color:#f92672">(</span>str<span style="color:#f92672">)</span>
</code></pre></div><h2 id="读取-json-文件为-struct-结构体">读取 json 文件为 struct 结构体</h2>
<blockquote>
<p>这里的路径是从 二进制文件所在的根目录下开始读取 filePath</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">// readJSON: 从 filePath 里读取数据, 并转换为 jsonObject 对象
func readJSON<span style="color:#f92672">(</span>filePath string, jsonObject interface<span style="color:#f92672">{})</span> <span style="color:#f92672">{</span>
	appPath, e :<span style="color:#f92672">=</span> os.Executable<span style="color:#f92672">()</span>
	<span style="color:#66d9ef">if</span> e !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
		logrus.Errorf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;File error: %v\n&#34;</span>, e<span style="color:#f92672">)</span>
		os.Exit<span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span>

	file, e :<span style="color:#f92672">=</span> ioutil.ReadFile<span style="color:#f92672">(</span>path.Dir<span style="color:#f92672">(</span>appPath<span style="color:#f92672">)</span> + <span style="color:#e6db74">&#34;/&#34;</span> + filePath<span style="color:#f92672">)</span>
	<span style="color:#66d9ef">if</span> e !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
		logrus.Errorf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;File error: %v\n&#34;</span>, e<span style="color:#f92672">)</span>
		os.Exit<span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span>
	e <span style="color:#f92672">=</span> json.Unmarshal<span style="color:#f92672">(</span>file, jsonObject<span style="color:#f92672">)</span>
	<span style="color:#66d9ef">if</span> e !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
		logrus.Errorf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;invalid json data error: %v\n&#34;</span>, e<span style="color:#f92672">)</span>
		os.Exit<span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="string-与-int-互转">string 与 int 互转</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">int -&gt; string
strconv.Itoa<span style="color:#f92672">(</span>e.Port<span style="color:#f92672">)</span>

string -&gt; int
v, _ <span style="color:#f92672">=</span> strconv.Atoi<span style="color:#f92672">(</span>str<span style="color:#f92672">)</span>
</code></pre></div><h2 id="go-中-http-client-的-timeout-设置">Go 中 http client 的 timeout 设置</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">timeout :<span style="color:#f92672">=</span> time.Duration<span style="color:#f92672">(</span><span style="color:#ae81ff">5</span> * time.Second<span style="color:#f92672">)</span>
client :<span style="color:#f92672">=</span> http.Client<span style="color:#f92672">{</span>
    Timeout: timeout,
<span style="color:#f92672">}</span>
client.Get<span style="color:#f92672">(</span>url<span style="color:#f92672">)</span>
</code></pre></div>
    </div>

    
    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">emacsist</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">2016-10-18</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>

    
    
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">Reward</label>
  <div class="qr-code">
    
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/img/wxpay.jpeg">
        <span>wechat</span>
      </label>
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/img/alipay.jpeg">
        <span>alipay</span>
      </label>
  </div>
</div>

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/golang/">golang</a>
          
          <a href="/tags/go/">go</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="https://emacsist.github.io/2016/10/30/golang-%E4%B8%AD%E8%87%AA%E5%AE%9A%E4%B9%89-json-%E8%BD%AC%E6%8D%A2/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Golang 中自定义 JSON 转换</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="https://emacsist.github.io/2016/10/17/mysql%E4%B8%AD%E6%8C%89%E6%9D%A1%E4%BB%B6count/">
            <span class="next-text nav-default">MySQL中按条件count</span>
            <span class="prev-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  <div id="comments-gitment"></div>
  <link rel="stylesheet" href="/lib/gitment/gitment-0.0.3.min.css">
    <script src="/lib/gitment/gitment-0.0.3.min.js"></script>
  <script type="text/javascript">
  const gitment = new Gitment({
    id: '2016-10-18 19:35:00 \x2b0000 UTC',
    title: 'Go学习',
    link: decodeURI(location.href),
    desc: '安装多个版本的 go GVM Go依赖管理与 GOPATH 的关系. GOPATH环境变',
    owner: 'emacsist',
    repo: 'emacsist.github.io',
    oauth: {
      client_id: 'd1456501fba5329f3afa',
      client_secret: 'd1ecbb7929a49de947215701320c60b312a72d3a'
    }
  })
  gitment.render('comments-gitment')
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://github.com/imsun/gitment">comments powered by gitment.</a></noscript>

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:emacsist@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://twitter.com/emacsist2016" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://plus.google.com/u/0/114200054463267049438" class="iconfont icon-google" title="google"></a>
      <a href="https://github.com/emacsist" class="iconfont icon-github" title="github"></a>
      <a href="https://www.zhihu.com/people/emacist" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://www.douban.com/people/emacsist/" class="iconfont icon-douban" title="douban"></a>
  <a href="https://emacsist.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
    <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>


  <span class="copyright-year">
    &copy; 
    
      2014 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">emacsist</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  
<script type="text/javascript" src="/dist/even.min.js?v=3.1.1"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-118327923-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>









<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1278300546'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1278300546%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</body>
</html>
